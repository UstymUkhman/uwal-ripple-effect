(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const p of a)if(p.type==="childList")for(const x of p.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&n(x)}).observe(document,{childList:!0,subtree:!0});function t(a){const p={};return a.integrity&&(p.integrity=a.integrity),a.referrerPolicy&&(p.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?p.credentials="include":a.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function n(a){if(a.ep)return;a.ep=!0;const p=t(a);fetch(a.href,p)}})();var wi=Object.defineProperty,Bs=i=>{throw TypeError(i)},ki=(i,e,t)=>e in i?wi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ur=(i,e,t)=>ki(i,typeof e!="symbol"?e+"":e,t),Zn=(i,e,t)=>e.has(i)||Bs("Cannot "+t),l=(i,e,t)=>(Zn(i,e,"read from private field"),t?t.call(i):e.get(i)),P=(i,e,t)=>e.has(i)?Bs("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),F=(i,e,t,n)=>(Zn(i,e,"write to private field"),e.set(i,t),t),W=(i,e,t)=>(Zn(i,e,"access private method"),t),wt,kt,xt,Je;const xi=class Is{constructor(e=0,t,n,a=255){P(this,wt,0),P(this,kt,0),P(this,xt,0),P(this,Je,1),typeof t=="number"&&typeof n=="number"?this.RGBA=[e,t,n,a]:(F(this,wt,(e>>16&255)/255),F(this,kt,(e>>8&255)/255),F(this,xt,(e&255)/255),F(this,Je,a/255))}Set(e,t=255){return F(this,wt,(e>>16&255)/255),F(this,kt,(e>>8&255)/255),F(this,xt,(e&255)/255),F(this,Je,t/255),this}Premultiply(e,t){t??(t=new Is),e??(e=l(this,Je));const n=l(this,wt)*e,a=l(this,kt)*e,p=l(this,xt)*e;return t.rgba=[n,a,p,e],t}set rgb(e){F(this,wt,e[0]),F(this,kt,e[1]),F(this,xt,e[2]),F(this,Je,e[3]??1)}get rgb(){return[l(this,wt),l(this,kt),l(this,xt)]}set a(e){F(this,Je,e)}get a(){return l(this,Je)}set rgba(e){this.rgb=e}get rgba(){return this.rgb.concat(l(this,Je))}set RGB(e){F(this,wt,e[0]/255),F(this,kt,e[1]/255),F(this,xt,e[2]/255),F(this,Je,(e[3]??255)/255)}get RGB(){return[l(this,wt)*255,l(this,kt)*255,l(this,xt)*255]}set A(e){F(this,Je,e/255)}get A(){return l(this,Je)*255}set RGBA(e){this.RGB=e}get RGBA(){return this.RGB.concat(this.A)}};wt=new WeakMap,kt=new WeakMap,xt=new WeakMap,Je=new WeakMap;let tn=xi;const vi=ie({RAD:Math.PI/180,DEG:180/Math.PI,HPI:Math.PI/2,TAU:Math.PI*2}),bi={CANVAS_NOT_FOUND:"CANVAS_NOT_FOUND",CONTEXT_NOT_FOUND:"CONTEXT_NOT_FOUND",SHADER_CODE_NOT_FOUND:"SHADER_CODE_NOT_FOUND",SHADER_MODULE_NOT_FOUND:"SHADER_MODULE_NOT_FOUND",VERTEX_ENTRY_NOT_FOUND:"VERTEX_ENTRY_NOT_FOUND",VERTEX_ATTRIBUTE_NOT_FOUND:"VERTEX_ATTRIBUTE_NOT_FOUND",RENDER_PASS_NOT_FOUND:"RENDER_PASS_NOT_FOUND",STORAGE_NOT_FOUND:"STORAGE_NOT_FOUND",UNIFORM_NOT_FOUND:"UNIFORM_NOT_FOUND",INVALID_UNIFORM_NAME:"INVALID_UNIFORM_NAME",BINDING_NOT_FOUND:"BINDING_NOT_FOUND",PIPELINE_NOT_FOUND:"PIPELINE_NOT_FOUND",COMMAND_ENCODER_NOT_FOUND:"COMMAND_ENCODER_NOT_FOUND"},Ti={CANVAS_NOT_FOUND:"Failed to get a WebGPU canvas.",CONTEXT_NOT_FOUND:"Failed to get a WebGPU context.",SHADER_CODE_NOT_FOUND:`Failed to get a WGSL shader when creating shader module.
        An empty shader will be used instead.`,SHADER_MODULE_NOT_FOUND:"Failed to get shader module in ",VERTEX_ENTRY_NOT_FOUND:"Failed to find function ",VERTEX_ATTRIBUTE_NOT_FOUND:"Failed to find vertex attribute ",RENDER_PASS_NOT_FOUND:"Failed to use pipeline in render pass because it has not started.",STORAGE_NOT_FOUND:"Failed to find storage ",UNIFORM_NOT_FOUND:"Failed to find uniform ",INVALID_UNIFORM_NAME:"Requested uniform is already in use and managed internally: ",BINDING_NOT_FOUND:"Failed to find binding ",PIPELINE_NOT_FOUND:"Failed to get a GPU",COMMAND_ENCODER_NOT_FOUND:"Failed to get a GPUCommandEncoder."},Ei={CANVAS_NOT_FOUND:5,CONTEXT_NOT_FOUND:6,PIPELINE_NOT_FOUND:7,COMMAND_ENCODER_NOT_FOUND:8},Mi={RENDER_PIPELNE_NOT_FOUND:"RENDER_PIPELNE_NOT_FOUND",TEXTURE_SIZE_NOT_FOUND:"TEXTURE_SIZE_NOT_FOUND",TEXTURE_NOT_FOUND:"TEXTURE_NOT_FOUND",INVALID_BYTES_PER_ROW:"INVALID_BYTES_PER_ROW"},Si={RENDER_PIPELNE_NOT_FOUND:'"UWAL.RenderPipeline" instance is required in `Texture` for this operation.\n        Pass it to the `Texture` constructor or use `Texture.Renderer` setter before ',TEXTURE_SIZE_NOT_FOUND:"`size` array or a `width` value is required in `options` parameter of ",TEXTURE_NOT_FOUND:"`options` is required to have a `texture` value or its `create` entry\n        to be either `true` or a `TextureDescriptor` object when calling ",INVALID_BYTES_PER_ROW:"`bytesPerRow` parameter is not multiple of 256 in "},Ai={FONT_TEXTURE_NOT_FOUND:"FONT_TEXTURE_NOT_FOUND"},Ni={FONT_TEXTURE_NOT_FOUND:"Failed to find a font texture in "},Oi={TIMESTAMP_QUERY_NOT_FOUND:"TIMESTAMP_QUERY_NOT_FOUND"},Ci={TIMESTAMP_QUERY_NOT_FOUND:'"timestamp-query" feature is required to be set with\n        `UWAL.SetRequiredFeatures` when creating a new `GPUTiming` instance.'};ie({DEVICE_LOST:"Device::Lost"});const Y=ie({FORMAT_NOT_SUPPORTED:"FORMAT_NOT_SUPPORTED",WEBGPU_NOT_SUPPORTED:"WEBGPU_NOT_SUPPORTED",ADAPTER_NOT_FOUND:"ADAPTER_NOT_FOUND",FEATURE_NOT_FOUND:"FEATURE_NOT_FOUND",DEVICE_NOT_FOUND:"DEVICE_NOT_FOUND",DEVICE_NOT_REQUESTED:"DEVICE_NOT_REQUESTED",DEVICE_LOST:"DEVICE_LOST",...bi,...Mi,...Ai,...Oi}),Gs=ie({FORMAT_NOT_SUPPORTED:"Format is not yet supported: ",WEBGPU_NOT_SUPPORTED:"WebGPU is not supported in this browser.",ADAPTER_NOT_FOUND:"Failed to get a GPUAdapter.",DEVICE_NOT_FOUND:"Failed to get a GPUDevice.",FEATURE_NOT_FOUND:"Failed to get a GPUFeature ",DEVICE_NOT_REQUESTED:"GPUDevice was not requested.",DEVICE_LOST:"WebGPU device was lost. ",...Ti,...Si,...Ni,...Ci}),Ri=ie({WEBGPU_NOT_SUPPORTED:0,ADAPTER_NOT_FOUND:1,DEVICE_NOT_FOUND:2,DEVICE_NOT_REQUESTED:3,DEVICE_LOST:4,...Ei});function It(i,e){console.warn(`${Gs[i]}${e??""}`.replace(/\s\s+/g," "))}function te(i,e){throw new Error(`${Gs[i]}${e??""}`.replace(/\s\s+/g," "),{cause:Ri[i]})}const rs=ie({RENDER:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,STORAGE:GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.TEXTURE_BINDING});ie({ALL:"all",STENCIL:"stencil-only",DEPTH:"depth-only"});ie({CLAMP:"clamp-to-edge",REPEAT:"repeat",MIRROR:"mirror-repeat"});const ns=ie({NEAREST:"nearest",LINEAR:"linear"});ie({NEVER:"never",LESS:"less",EQUAL:"equal",LESS_EQUAL:"less-equal",GREATER:"greater",NOT_EQUAL:"not-equal",GREATER_EQUAL:"greater-equal",ALWAYS:"always"});var Ls="struct Shape{color: vec4f,matrix: mat3x3f};@group(0)@binding(0)var<uniform>resolution: vec2f;fn GetClipSpace(position: vec2f)->vec2f{let clipSpace=position/resolution*2-1;return clipSpace*vec2f(1,-1);}@group(0)@binding(1)var<uniform>shape: Shape;fn GetVertexClipSpace(position: vec2f)->vec4f{let matrixPosition=shape.matrix*vec3f(position,1);let clipSpace=GetClipSpace(matrixPosition.xy);return vec4f(clipSpace,0,1);}@vertex fn shapeVertex(@location(0)position: vec2f)->@builtin(position)vec4f {return GetVertexClipSpace(position);}",qs="@fragment fn shapeFragment()->@location(0)vec4f {return shape.color;}",Vs="@vertex fn vertex()->@builtin(position)vec4f {return vec4f(0);}@fragment fn fragment()->@location(0)vec4f {return vec4f(0);}@compute @workgroup_size(1)fn compute(){}",zs="const QUAD=array(vec2f(-1.0,-1.0),vec2f(1.0,-1.0),vec2f(1.0,1.0),vec2f(1.0,1.0),vec2f(-1.0,1.0),vec2f(-1.0,-1.0));fn GetQuadCoord(index: u32)->vec2f{return QUAD[index];}struct VertexOutput{@builtin(position)position: vec4f,@location(0)textureCoord: vec2f};@group(0)@binding(0)var Sampler: sampler;@group(0)@binding(1)var Texture: texture_2d<f32>;@vertex fn vertex(@builtin(vertex_index)index: u32)->VertexOutput {let position=GetQuadCoord(index);let coord=(position+1)*0.5;var output: VertexOutput;output.position=vec4f(position,0.0,1.0);output.textureCoord=vec2f(coord.x,1-coord.y);return output;}@fragment fn fragment(@location(0)textureCoord: vec2f)->@location(0)vec4f {return textureSample(Texture,Sampler,textureCoord);}",Ui="const QUAD=array(vec2f(-1.0,-1.0),vec2f(1.0,-1.0),vec2f(1.0,1.0),vec2f(1.0,1.0),vec2f(-1.0,1.0),vec2f(-1.0,-1.0));fn GetQuadCoord(index: u32)->vec2f{return QUAD[index];}",Di="@group(0)@binding(0)var<uniform>resolution: vec2f;fn GetClipSpace(position: vec2f)->vec2f{let clipSpace=position/resolution*2-1;return clipSpace*vec2f(1,-1);}",Ws="enable dual_source_blending;struct DSBFragmentOutput{@location(0)@blend_src(0)source: vec4f,@location(0)@blend_src(1)factor: vec4f};@fragment fn dsbTextFragment(input: TextVertexOutput)->DSBFragmentOutput {var output: DSBFragmentOutput;let coverage=GetSubpixelCoverage(input.inverseTexureSize,input.distanceDelta,input.fontUV);output.source=Font.color;output.factor=vec4f(coverage,Font.color.a);return output;}",$s="override TRIPLET_FACTOR=0.6;const THRESHOLD=20.0/256.0;const MIN_GRAD=THRESHOLD*0.1;struct font{color: vec4f,back: vec4f,subpx: f32,hint: f32};struct text{matrix: mat3x3f,texureSize: vec2f};struct TextVertexOutput{@location(0)fontUV: vec2f,@location(1)screenUV: vec2f,@location(2)distanceDelta: f32,@builtin(position)position: vec4f,@location(3)inverseTexureSize: vec2f};@group(0)@binding(0)var Sampler: sampler;@group(0)@binding(1)var<uniform>Text: text;@group(0)@binding(2)var<uniform>Font: font;@group(0)@binding(3)var Texture: texture_2d<f32>;@vertex fn textVertex(@location(0)position: vec2f,@location(1)texture: vec2f,@location(2)size: f32)->TextVertexOutput{var output: TextVertexOutput;let clipSpace=Text.matrix*vec3f(position,1);output.inverseTexureSize=1.0/Text.texureSize;output.position=vec4f(clipSpace.xy,0,1);output.distanceDelta=1.0/size;output.screenUV=clipSpace.xy;output.fontUV=texture;return output;}fn GetSubpixelCoverage(size: vec2f,distance: f32,uv: vec2f)->vec3f{let sdf=textureSample(Texture,Sampler,uv).r;let sdfX=textureSample(Texture,Sampler,uv+vec2f(size.x,0)).r;let sdfY=textureSample(Texture,Sampler,uv+vec2f(0,size.y)).r;let strokeGradient=vec2f(sdfX-sdf,sdfY-sdf);let strokeGradientLength=max(length(strokeGradient),MIN_GRAD);let gradient=strokeGradient/vec2f(strokeGradientLength);let verticalGradient=abs(gradient.y);let horizontalDelta=mix(distance*1.1,distance*0.6,verticalGradient);let resultDelta=mix(distance,horizontalDelta,Font.hint);var alpha=smoothstep(0.5-resultDelta,resultDelta+0.5,sdf);alpha=pow(alpha,Font.hint*verticalGradient*0.2+1);if(alpha<THRESHOLD){discard;}let triplet=Font.subpx*gradient.x*0.5;let z=TRIPLET_FACTOR*triplet;let top=abs(z);let max=vec3f(-z,0,z);let average=vec3f(mix(top,-top-1,alpha));return clamp(max-average,vec3f(0),vec3f(1));}@fragment fn textFragment(input: TextVertexOutput)->@location(0)vec4f {let coverage=GetSubpixelCoverage(input.inverseTexureSize,input.distanceDelta,input.fontUV);return vec4f(mix(Font.back.rgb,Font.color.rgb,coverage),Font.color.a);}";const Fi=`${Ls}

${qs}`,Xs=Object.freeze(Object.defineProperty({__proto__:null,Empty:Vs,Mipmaps:zs,Quad:Ui,Resolution:Di,SDFText:$s,SDFTextDSB:Ws,Shape:Fi,ShapeFragment:qs,ShapeVertex:Ls},Symbol.toStringTag,{value:"Module"}));var dt,ft,j,er,qt,be,At,hr,Pn,Bn;class Ys{constructor(e,t){P(this,be),P(this,dt),P(this,ft),P(this,j),P(this,er),P(this,qt),!e&&te(Y.DEVICE_NOT_REQUESTED),F(this,j,t),F(this,dt,e)}CreateSampler(e){if(!e)return l(this,dt).createSampler();const{addressModeUV:t,addressMode:n,minMagFilter:a,filter:p}=e;return t&&(e.addressModeU=e.addressModeV=t),n&&(e.addressModeU=e.addressModeV=e.addressModeW=n),a&&(e.minFilter=e.magFilter=a),p&&(e.minFilter=e.magFilter=e.mipmapFilter=p),l(this,dt).createSampler(e)}CreateTexture(e){const t=e.label??"Texture",{format:n="rgba8unorm",usage:a=rs.RENDER}=e;return l(this,dt).createTexture({label:t,format:n,usage:a,...e})}WriteTexture(e,t){const{texture:n,mipLevel:a,origin:p,aspect:x,offset:S,rowsPerImage:O}=t,[B,I]=W(this,be,At).call(this,n);let{bytesPerRow:V}=t;V??(V=(t.width??B)*Float32Array.BYTES_PER_ELEMENT),l(this,dt).queue.writeTexture({texture:n,mipLevel:a,origin:p,aspect:x},e,{offset:S,bytesPerRow:V,rowsPerImage:O},W(this,be,hr).call(this,{width:B,height:I,...t},"WriteTexture"))}CreateStorageTexture(e){let{size:t}=e;const n=rs.STORAGE|e.usage,a=e.label??"Storage Texture",{format:p=this.PreferredStorageFormat}=e;return t=l(this,j)&&!t?l(this,j).CanvasSize:t,this.CreateTexture({label:a,size:t,format:p,...e,usage:n})}CreateBitmapImage(e,t){return createImageBitmap(e,t)}CreateTextureFromSource(e,t={}){t=typeof t=="boolean"&&{}||t;const n=t.size,a=t.size,p=t.mipLevelCount??((t.mipmaps??!0)&&this.GetMipmapLevels(e)||void 0),x=Array.isArray(t.size)||!t.size?n??W(this,be,At).call(this,e):[a.width,a.height];return this.CreateTexture({size:x,mipLevelCount:p,...t})}ImportExternalTexture(e,t,n){return l(this,dt).importExternalTexture({source:e,label:t,colorSpace:n})}CreateMultisampleTexture(e=!1,t=4,n){var a;!l(this,j)&&te(Y.RENDER_PIPELNE_NOT_FOUND,"creating a multisample texture.");const{width:p,height:x,format:S}=l(this,j).CurrentTexture;return(e||!l(this,ft)||l(this,ft).width!==p||l(this,ft).height!==x)&&((a=l(this,ft))==null||a.destroy(),F(this,ft,this.CreateTexture({usage:GPUTextureUsage.RENDER_ATTACHMENT,label:n??"Multisample Texture",size:[p,x],sampleCount:t,format:S}))),l(this,ft)}CopyImageToTexture(e,t={create:!0}){var n;let{create:a,texture:p}=t;const[x,S]=W(this,be,At).call(this,e),{flipY:O,mipLevel:B,aspect:I,colorSpace:V,premultipliedAlpha:z,mipmaps:H}=t;return H===!1&&((n=a=typeof a=="object"&&a||{}).mipmaps??(n.mipmaps=!1)),!p&&!a&&te(Y.TEXTURE_NOT_FOUND,"`CopyImageToTexture`."),p??(p=this.CreateTextureFromSource(e,a)),l(this,dt).queue.copyExternalImageToTexture({source:e,origin:t.sourceOrigin,flipY:O},{texture:p,mipLevel:B,origin:t.destinationOrigin,aspect:I,colorSpace:V,premultipliedAlpha:z},W(this,be,hr).call(this,{width:x,height:S,...t},"CopyImageToTexture")),(H??!0)&&1<p.mipLevelCount&&(p.depthOrArrayLayers===1?this.GenerateMipmaps(p):this.GenerateCubeMipmaps(p)),p}CopyTextureToTexture(e){const{source:t,create:n}=e;let{srcTexture:a,dstTexture:p}=e;!l(this,j)&&te(Y.RENDER_PIPELNE_NOT_FOUND,"copying a texture to a texture."),!a&&!t&&!n&&te(Y.TEXTURE_NOT_FOUND,"`CopyTextureToTexture`."),a??(a=this.CreateTextureFromSource(t,n)),p??(p=this.CreateTextureFromSource(a,n));const{srcMipLevel:x,srcOrigin:S,srcAspect:O}=e,{dstMipLevel:B,dstOrigin:I,dstAspect:V}=e,[z,H]=W(this,be,At).call(this,a);l(this,j).GetCommandEncoder(!0).copyTextureToTexture({texture:a,mipLevel:x,origin:S,aspect:O},{texture:p,mipLevel:B,origin:I,aspect:V},W(this,be,hr).call(this,{width:z,height:H,...e},"CopyTextureToTexture"))}CopyTextureToBuffer(e){const{source:t,create:n}=e;let{texture:a,bytesPerRow:p}=e;!l(this,j)&&te(Y.RENDER_PIPELNE_NOT_FOUND,"copying a texture to a buffer."),!a&&!t&&!n&&te(Y.TEXTURE_NOT_FOUND,"`CopyTextureToBuffer`."),a??(a=this.CreateTextureFromSource(t,n));const[x,S]=W(this,be,At).call(this,a),{buffer:O,offset:B,rowsPerImage:I,mipLevel:V,origin:z,aspect:H}=e;p??(p=(e.width??x)*Float32Array.BYTES_PER_ELEMENT),W(this,be,Pn).call(this,p,"CopyTextureToBuffer"),l(this,j).GetCommandEncoder(!0).copyTextureToBuffer({texture:a,mipLevel:V,origin:z,aspect:H},{buffer:O,offset:B,bytesPerRow:p,rowsPerImage:I},W(this,be,hr).call(this,{width:x,height:S,...e},"CopyTextureToBuffer"))}CopyBufferToTexture(e){const{source:t,create:n}=e;let{texture:a,bytesPerRow:p}=e;!l(this,j)&&te(Y.RENDER_PIPELNE_NOT_FOUND,"copying a buffer to a texture."),!a&&!t&&!n&&te(Y.TEXTURE_NOT_FOUND,"`CopyBufferToTexture`."),a??(a=this.CreateTextureFromSource(t,n));const[x,S]=W(this,be,At).call(this,a),{buffer:O,offset:B,rowsPerImage:I,mipLevel:V,origin:z,aspect:H}=e;p??(p=(e.width??x)*Float32Array.BYTES_PER_ELEMENT),W(this,be,Pn).call(this,p,"CopyBufferToTexture"),l(this,j).GetCommandEncoder(!0).copyBufferToTexture({buffer:O,offset:B,bytesPerRow:p,rowsPerImage:I},{texture:a,mipLevel:V,origin:z,aspect:H},W(this,be,hr).call(this,{width:x,height:S,...e},"CopyBufferToTexture"))}get PreferredStorageFormat(){const e=Or.PreferredCanvasFormat;return l(this,dt).features.has("bgra8unorm-storage")&&e==="bgra8unorm"?e:"rgba8unorm"}GenerateCubeMipmaps(e){W(this,be,Bn).call(this,e,{minMagFilter:ns.LINEAR},t=>{for(let n=0;n<e.depthOrArrayLayers;++n)l(this,j).SetBindGroups(l(this,j).CreateBindGroup(l(this,j).CreateBindGroupEntries([l(this,er),e.createView({arrayLayerCount:1,baseArrayLayer:n,mipLevelCount:1,dimension:"2d",baseMipLevel:t})]))),l(this,j).CreatePassDescriptor(l(this,j).CreateColorAttachment(e.createView({baseMipLevel:t+1,arrayLayerCount:1,baseArrayLayer:n,mipLevelCount:1,dimension:"2d"}))),l(this,j).Render(6,!1),l(this,j).DestroyCurrentPass()})}GenerateMipmaps(e){W(this,be,Bn).call(this,e,{minFilter:ns.LINEAR},t=>{l(this,j).SetBindGroups(l(this,j).CreateBindGroup(l(this,j).CreateBindGroupEntries([l(this,er),e.createView({baseMipLevel:t++,mipLevelCount:1})]))),l(this,j).CreatePassDescriptor(l(this,j).CreateColorAttachment(e.createView({baseMipLevel:t,mipLevelCount:1}))),l(this,j).Render(6,!1),l(this,j).DestroyCurrentPass()})}GetMipmapLevels(e){const[t,n]=W(this,be,At).call(this,e);return(Math.log2(Math.max(t,n))|0)+1}set Renderer(e){F(this,j,e)}SetRenderer(e){this.Renderer=e}Destroy(){var e;F(this,ft,(e=l(this,ft))==null?void 0:e.destroy())}}dt=new WeakMap,ft=new WeakMap,j=new WeakMap,er=new WeakMap,qt=new WeakMap,be=new WeakSet,At=function(i){return i instanceof HTMLVideoElement?[i.videoWidth,i.videoHeight]:i instanceof VideoFrame?[i.codedWidth,i.codedHeight]:[i.width,i.height]},hr=function(i,e){const{size:t,width:n,height:a,depthOrArrayLayers:p}=i;return!t&&!n&&te(Y.TEXTURE_SIZE_NOT_FOUND,`\`${e}\` method.`),t??{width:n,height:a,depthOrArrayLayers:p}},Pn=function(i,e){const t=i/256;t!==(t|0)&&It(Y.INVALID_BYTES_PER_ROW,`\`${e}\` options.`)},Bn=function(i,e,t){!l(this,j)&&te(Y.RENDER_PIPELNE_NOT_FOUND,"creating a texture with mipmaps."),l(this,j).SavePipelineState(),l(this,j).ResetPipelineState(),(!l(this,qt)||!l(this,er))&&(F(this,qt,l(this,j).CreateShaderModule(zs)),F(this,er,this.CreateSampler(e)));let n=0,a=i.width,p=i.height;for(l(this,j).CreatePipeline({vertex:l(this,j).CreateVertexState(l(this,qt)),fragment:l(this,j).CreateFragmentState(l(this,qt),void 0,l(this,j).CreateTargetState(i.format))});1<a||1<p;)a=Math.max(a*.5|0,1),p=Math.max(p*.5|0,1),t(n++);l(this,j).SubmitCommandBuffer(),l(this,j).SetCommandEncoder(void 0),l(this,j).RestorePipelineState(),F(this,qt,F(this,er,void 0))};/**
 * @module UWAL
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description Unopinionated WebGPU Abstraction Library
 * @version 0.0.10
 * @license MIT
 */var qr,Sr,Vr,zr,bt,tr,In,ss,Hs,Qs;const Se=class se{static async CreateQuerySet(e,t){const n=(await se.Device).createQuerySet({type:e,count:t});return l(se,qr).push(n),n}static RenderPipeline(e,t="",n={}){return n.format??(n.format=se.PreferredCanvasFormat),W(this,tr,In).call(this,t),(async()=>{const a=await se.Device;return new Proxy(Ta,{construct(p){return new p(a,t,e,n)}})})()}static ComputePipeline(e=""){return W(this,tr,In).call(this,e),(async()=>{const t=await se.Device;return new Proxy(Ea,{construct(n){return new n(t,e)}})})()}static Texture(e){return(async()=>{const t=await se.Device;return new Proxy(Ys,{construct(n){return new n(t,e)}})})()}static Destroy(e,t){var n;l(se,qr).forEach(a=>a.destroy()),e=Array.isArray(e)&&e||[e],e.forEach(a=>a?.destroy()),t=Array.isArray(t)&&t||[t],t.forEach(a=>a?.destroy()),(n=l(se,Sr))==null||n.destroy(),l(se,qr).splice(0),F(se,Vr,F(se,Sr,null)),l(se,bt).requiredFeatures.clear(),se.DescriptorLabel=se.RequiredLimits=void 0,se.PowerPreference=se.ForceFallbackAdapter=void 0}static set PowerPreference(e){l(se,zr).powerPreference=e}static set ForceFallbackAdapter(e){l(se,zr).forceFallbackAdapter=e}static set DescriptorLabel(e){l(se,bt).label=e}static async SetRequiredFeatures(e){const t=(await se.Adapter).features;return e=Array.isArray(e)&&e||[e],e.forEach(n=>t.has(n)?l(se,bt).requiredFeatures.add(n):It(Y.FEATURE_NOT_FOUND,`"${n}".
It will be skipped when requesting a GPUDevice.`)),l(se,bt).requiredFeatures}static set RequiredLimits(e){l(se,bt).requiredLimits=e}static get PreferredCanvasFormat(){return!navigator.gpu&&te(Y.WEBGPU_NOT_SUPPORTED),navigator.gpu.getPreferredCanvasFormat()}static get Adapter(){return(async()=>{var e;return l(se,Vr)??await W(e=se,tr,Hs).call(e)()})()}static get Device(){return(async()=>{var e;return l(se,Sr)??await W(e=se,tr,Qs).call(e)()})()}static get VERSION(){return"0.0.10"}};qr=new WeakMap,Sr=new WeakMap,Vr=new WeakMap,zr=new WeakMap,bt=new WeakMap,tr=new WeakSet,In=function(i){var e;(e=l(Se,bt)).label??(e.label=i&&`${i} Device`||"")},ss=function(i){if(Se.OnDeviceLost)return Se.OnDeviceLost(i);const e=(i.message&&` | Message: ${i.message}`)??".";te(Y.DEVICE_LOST,`Reason: ${i.reason}`+e)},Hs=function(){return!navigator.gpu&&te(Y.WEBGPU_NOT_SUPPORTED),async()=>{const i=await navigator.gpu.requestAdapter(l(Se,zr));return!i&&te(Y.ADAPTER_NOT_FOUND),F(Se,Vr,i)}},Qs=function(){return async()=>{const{requiredFeatures:i,requiredLimits:e,label:t}=l(Se,bt),n=await(await Se.Adapter).requestDevice({requiredFeatures:i,requiredLimits:e,defaultQueue:{label:t}});return!n&&te(Y.DEVICE_NOT_FOUND),n.lost.then(W(Se,tr,ss)),F(Se,Sr,n)}},P(Se,tr),P(Se,qr,[]),P(Se,Sr,null),P(Se,Vr,null),P(Se,zr,{powerPreference:void 0,forceFallbackAdapter:!1}),ur(Se,"OnDeviceLost"),P(Se,bt,{label:void 0,requiredFeatures:new Set,requiredLimits:void 0});let Or=Se;function ie(i){for(let e in i)i[e]={value:i[e]};return Object.freeze(Object.create(null,i))}function Pi(i){switch(i){case 2:return"unorm8x2";case 4:return"float32";case 8:return"float32x2";case 12:return"float32x3";case 16:return"float32x4"}}function Bi(i){switch(i){case"uint8x2":case"sint8x2":case"unorm8x2":case"snorm8x2":return 2;case"uint32":case"sint32":case"float32":case"uint8x4":case"sint8x4":case"unorm8x4":case"snorm8x4":case"uint16x2":case"sint16x2":case"unorm16x2":case"snorm16x2":case"float16x2":return 4;case"uint16x4":case"sint16x4":case"uint32x2":case"sint32x2":case"unorm16x4":case"snorm16x4":case"float16x4":case"float32x2":return 8;case"uint32x3":case"sint32x3":case"float32x3":return 12;case"uint32x4":case"sint32x4":case"float32x4":return 16}return 0}function Ii(i){return i==="f16"||i.includes("h")?"f16":i.includes("f")?"f32":i.includes("u")?"u32":"i32"}function Gi(i){return+i.slice(1)/8}function Li(i){return i==="f16"&&te(Y.FORMAT_NOT_SUPPORTED,`${i}.`),i==="f32"?Float32Array:i==="u32"?Uint32Array:Int32Array}const is={operation:"add",srcFactor:"one",dstFactor:"zero"},as={operation:"add",srcFactor:"one",dstFactor:"one"},os={operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"},cs={operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"one"},us={operation:"add",srcFactor:"dst-alpha",dstFactor:"zero"},hs={operation:"add",srcFactor:"zero",dstFactor:"src-alpha"},ls={operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"zero"},ds={operation:"add",srcFactor:"zero",dstFactor:"one-minus-src-alpha"},fs={operation:"add",srcFactor:"dst-alpha",dstFactor:"one-minus-src-alpha"},ps={operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"src-alpha"};ie({COPY:ie({color:is,alpha:is}),ADDITIVE:ie({color:as,alpha:as}),SOURCE_OVER:ie({color:os,alpha:os}),DESTINATION_OVER:ie({color:cs,alpha:cs}),SOURCE_IN:ie({color:us,alpha:us}),DESTINATION_IN:ie({color:hs,alpha:hs}),SOURCE_OUT:ie({color:ls,alpha:ls}),DESTINATION_OUT:ie({color:ds,alpha:ds}),SOURCE_ATOP:ie({color:fs,alpha:fs}),DESTINATION_ATOP:ie({color:ps,alpha:ps})});const Gt=ie({INDEX:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,VERTEX:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,STORAGE:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,UNIFORM:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,READABLE:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST,WRITABLE:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC});class qi{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Mt{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,t){if(e){t(bn.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(Tn.instance)}}}class bn extends Mt{}bn.instance=new bn;class Tn extends Mt{}Tn.instance=new Tn;class ce extends Mt{constructor(){super()}}class Gn extends ce{constructor(e,t,n,a,p,x){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=a,this.startLine=p,this.endLine=x}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}class Vi extends ce{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class zi extends ce{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Wi extends ce{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class $i extends ce{constructor(e,t,n,a){super(),this.init=e,this.condition=t,this.increment=n,this.body=a}get astNodeType(){return"for"}search(e){var t,n,a;(t=this.init)===null||t===void 0||t.search(e),(n=this.condition)===null||n===void 0||n.search(e),(a=this.increment)===null||a===void 0||a.search(e),this.searchBlock(this.body,e)}}class Qt extends ce{constructor(e,t,n,a,p){super(),this.name=e,this.type=t,this.storage=n,this.access=a,this.value=p}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Zs extends ce{constructor(e,t,n){super(),this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Ln extends ce{constructor(e,t,n,a,p){super(),this.name=e,this.type=t,this.storage=n,this.access=a,this.value=p}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class _s extends ce{constructor(e,t,n,a,p){super(),this.name=e,this.type=t,this.storage=n,this.access=a,this.value=p}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var Cr;(function(i){i.increment="++",i.decrement="--"})(Cr||(Cr={}));(function(i){function e(t){const n=t;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return i[n]}i.parse=e})(Cr||(Cr={}));class Xi extends ce{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var rn;(function(i){i.assign="=",i.addAssign="+=",i.subtractAssin="-=",i.multiplyAssign="*=",i.divideAssign="/=",i.moduloAssign="%=",i.andAssign="&=",i.orAssign="|=",i.xorAssign="^=",i.shiftLeftAssign="<<=",i.shiftRightAssign=">>="})(rn||(rn={}));(function(i){function e(t){const n=t;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}i.parse=e})(rn||(rn={}));class Yi extends ce{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class js extends ce{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}search(e){for(const t of this.args)t.search(e);e(this)}}class Hi extends ce{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class Qi extends ce{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"body"}}class Zi extends ce{constructor(e,t,n,a){super(),this.condition=e,this.body=t,this.elseif=n,this.else=a}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class ji extends ce{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Ji extends ce{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class Ki extends ce{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class ea extends ce{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class Js extends ce{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class ta extends ce{constructor(){super()}get astNodeType(){return"discard"}}class ra extends ce{constructor(){super()}get astNodeType(){return"break"}}class na extends ce{constructor(){super()}get astNodeType(){return"continue"}}class cr extends ce{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class Vt extends cr{constructor(e,t,n,a){super(e),this.members=t,this.startLine=n,this.endLine=a}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}}class Ks extends cr{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}}class sa extends cr{constructor(e,t,n,a){super(e),this.storage=t,this.type=n,this.access=a}get astNodeType(){return"pointer"}}class ei extends cr{constructor(e,t,n,a){super(e),this.attributes=t,this.format=n,this.count=a}get astNodeType(){return"array"}get isArray(){return!0}}class Dr extends cr{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class yt extends Mt{constructor(){super()}}class ia extends yt{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class gr extends yt{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}evaluate(e){return this.args[0].evaluate(e)}}class ti extends yt{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const t of this.args)t.search(e);e(this)}}class qn extends yt{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const t=e.constants.get(this.name);if(!t)throw new Error("Cannot evaluate node");return t.evaluate(e)}}class ms extends yt{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}evaluate(e){var t,n;if(this.initializer instanceof gr){const a=(t=this.postfix)===null||t===void 0?void 0:t.evaluateString(e),p=(n=this.initializer.type)===null||n===void 0?void 0:n.name,x=e.structs.get(p),S=x?.getMemberIndex(a);return S!==void 0&&S!=-1?this.initializer.args[S].evaluate(e):this.initializer.evaluate(e)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class gs extends yt{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class aa extends yt{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class ys extends yt{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class oa extends yt{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class ri extends yt{constructor(){super()}}class ca extends ri{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class lt extends ri{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class ni extends Mt{constructor(){super()}}class ua extends ni{constructor(e,t){super(),this.selector=e,this.body=t}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class ha extends ni{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class la extends Mt{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class da extends Mt{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class fa extends Mt{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class pa extends Mt{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}var A,E;(function(i){i[i.token=0]="token",i[i.keyword=1]="keyword",i[i.reserved=2]="reserved"})(E||(E={}));class M{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class _{}A=_;_.none=new M("",E.reserved,"");_.eof=new M("EOF",E.token,"");_.reserved={asm:new M("asm",E.reserved,"asm"),bf16:new M("bf16",E.reserved,"bf16"),do:new M("do",E.reserved,"do"),enum:new M("enum",E.reserved,"enum"),f16:new M("f16",E.reserved,"f16"),f64:new M("f64",E.reserved,"f64"),handle:new M("handle",E.reserved,"handle"),i8:new M("i8",E.reserved,"i8"),i16:new M("i16",E.reserved,"i16"),i64:new M("i64",E.reserved,"i64"),mat:new M("mat",E.reserved,"mat"),premerge:new M("premerge",E.reserved,"premerge"),regardless:new M("regardless",E.reserved,"regardless"),typedef:new M("typedef",E.reserved,"typedef"),u8:new M("u8",E.reserved,"u8"),u16:new M("u16",E.reserved,"u16"),u64:new M("u64",E.reserved,"u64"),unless:new M("unless",E.reserved,"unless"),using:new M("using",E.reserved,"using"),vec:new M("vec",E.reserved,"vec"),void:new M("void",E.reserved,"void")};_.keywords={array:new M("array",E.keyword,"array"),atomic:new M("atomic",E.keyword,"atomic"),bool:new M("bool",E.keyword,"bool"),f32:new M("f32",E.keyword,"f32"),i32:new M("i32",E.keyword,"i32"),mat2x2:new M("mat2x2",E.keyword,"mat2x2"),mat2x3:new M("mat2x3",E.keyword,"mat2x3"),mat2x4:new M("mat2x4",E.keyword,"mat2x4"),mat3x2:new M("mat3x2",E.keyword,"mat3x2"),mat3x3:new M("mat3x3",E.keyword,"mat3x3"),mat3x4:new M("mat3x4",E.keyword,"mat3x4"),mat4x2:new M("mat4x2",E.keyword,"mat4x2"),mat4x3:new M("mat4x3",E.keyword,"mat4x3"),mat4x4:new M("mat4x4",E.keyword,"mat4x4"),ptr:new M("ptr",E.keyword,"ptr"),sampler:new M("sampler",E.keyword,"sampler"),sampler_comparison:new M("sampler_comparison",E.keyword,"sampler_comparison"),struct:new M("struct",E.keyword,"struct"),texture_1d:new M("texture_1d",E.keyword,"texture_1d"),texture_2d:new M("texture_2d",E.keyword,"texture_2d"),texture_2d_array:new M("texture_2d_array",E.keyword,"texture_2d_array"),texture_3d:new M("texture_3d",E.keyword,"texture_3d"),texture_cube:new M("texture_cube",E.keyword,"texture_cube"),texture_cube_array:new M("texture_cube_array",E.keyword,"texture_cube_array"),texture_multisampled_2d:new M("texture_multisampled_2d",E.keyword,"texture_multisampled_2d"),texture_storage_1d:new M("texture_storage_1d",E.keyword,"texture_storage_1d"),texture_storage_2d:new M("texture_storage_2d",E.keyword,"texture_storage_2d"),texture_storage_2d_array:new M("texture_storage_2d_array",E.keyword,"texture_storage_2d_array"),texture_storage_3d:new M("texture_storage_3d",E.keyword,"texture_storage_3d"),texture_depth_2d:new M("texture_depth_2d",E.keyword,"texture_depth_2d"),texture_depth_2d_array:new M("texture_depth_2d_array",E.keyword,"texture_depth_2d_array"),texture_depth_cube:new M("texture_depth_cube",E.keyword,"texture_depth_cube"),texture_depth_cube_array:new M("texture_depth_cube_array",E.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new M("texture_depth_multisampled_2d",E.keyword,"texture_depth_multisampled_2d"),texture_external:new M("texture_external",E.keyword,"texture_external"),u32:new M("u32",E.keyword,"u32"),vec2:new M("vec2",E.keyword,"vec2"),vec3:new M("vec3",E.keyword,"vec3"),vec4:new M("vec4",E.keyword,"vec4"),bitcast:new M("bitcast",E.keyword,"bitcast"),block:new M("block",E.keyword,"block"),break:new M("break",E.keyword,"break"),case:new M("case",E.keyword,"case"),continue:new M("continue",E.keyword,"continue"),continuing:new M("continuing",E.keyword,"continuing"),default:new M("default",E.keyword,"default"),diagnostic:new M("diagnostic",E.keyword,"diagnostic"),discard:new M("discard",E.keyword,"discard"),else:new M("else",E.keyword,"else"),enable:new M("enable",E.keyword,"enable"),fallthrough:new M("fallthrough",E.keyword,"fallthrough"),false:new M("false",E.keyword,"false"),fn:new M("fn",E.keyword,"fn"),for:new M("for",E.keyword,"for"),function:new M("function",E.keyword,"function"),if:new M("if",E.keyword,"if"),let:new M("let",E.keyword,"let"),const:new M("const",E.keyword,"const"),loop:new M("loop",E.keyword,"loop"),while:new M("while",E.keyword,"while"),private:new M("private",E.keyword,"private"),read:new M("read",E.keyword,"read"),read_write:new M("read_write",E.keyword,"read_write"),return:new M("return",E.keyword,"return"),requires:new M("requires",E.keyword,"requires"),storage:new M("storage",E.keyword,"storage"),switch:new M("switch",E.keyword,"switch"),true:new M("true",E.keyword,"true"),alias:new M("alias",E.keyword,"alias"),type:new M("type",E.keyword,"type"),uniform:new M("uniform",E.keyword,"uniform"),var:new M("var",E.keyword,"var"),override:new M("override",E.keyword,"override"),workgroup:new M("workgroup",E.keyword,"workgroup"),write:new M("write",E.keyword,"write"),r8unorm:new M("r8unorm",E.keyword,"r8unorm"),r8snorm:new M("r8snorm",E.keyword,"r8snorm"),r8uint:new M("r8uint",E.keyword,"r8uint"),r8sint:new M("r8sint",E.keyword,"r8sint"),r16uint:new M("r16uint",E.keyword,"r16uint"),r16sint:new M("r16sint",E.keyword,"r16sint"),r16float:new M("r16float",E.keyword,"r16float"),rg8unorm:new M("rg8unorm",E.keyword,"rg8unorm"),rg8snorm:new M("rg8snorm",E.keyword,"rg8snorm"),rg8uint:new M("rg8uint",E.keyword,"rg8uint"),rg8sint:new M("rg8sint",E.keyword,"rg8sint"),r32uint:new M("r32uint",E.keyword,"r32uint"),r32sint:new M("r32sint",E.keyword,"r32sint"),r32float:new M("r32float",E.keyword,"r32float"),rg16uint:new M("rg16uint",E.keyword,"rg16uint"),rg16sint:new M("rg16sint",E.keyword,"rg16sint"),rg16float:new M("rg16float",E.keyword,"rg16float"),rgba8unorm:new M("rgba8unorm",E.keyword,"rgba8unorm"),rgba8unorm_srgb:new M("rgba8unorm_srgb",E.keyword,"rgba8unorm_srgb"),rgba8snorm:new M("rgba8snorm",E.keyword,"rgba8snorm"),rgba8uint:new M("rgba8uint",E.keyword,"rgba8uint"),rgba8sint:new M("rgba8sint",E.keyword,"rgba8sint"),bgra8unorm:new M("bgra8unorm",E.keyword,"bgra8unorm"),bgra8unorm_srgb:new M("bgra8unorm_srgb",E.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new M("rgb10a2unorm",E.keyword,"rgb10a2unorm"),rg11b10float:new M("rg11b10float",E.keyword,"rg11b10float"),rg32uint:new M("rg32uint",E.keyword,"rg32uint"),rg32sint:new M("rg32sint",E.keyword,"rg32sint"),rg32float:new M("rg32float",E.keyword,"rg32float"),rgba16uint:new M("rgba16uint",E.keyword,"rgba16uint"),rgba16sint:new M("rgba16sint",E.keyword,"rgba16sint"),rgba16float:new M("rgba16float",E.keyword,"rgba16float"),rgba32uint:new M("rgba32uint",E.keyword,"rgba32uint"),rgba32sint:new M("rgba32sint",E.keyword,"rgba32sint"),rgba32float:new M("rgba32float",E.keyword,"rgba32float"),static_assert:new M("static_assert",E.keyword,"static_assert")};_.tokens={decimal_float_literal:new M("decimal_float_literal",E.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new M("hex_float_literal",E.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new M("int_literal",E.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new M("uint_literal",E.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new M("ident",E.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new M("and",E.token,"&"),and_and:new M("and_and",E.token,"&&"),arrow:new M("arrow ",E.token,"->"),attr:new M("attr",E.token,"@"),forward_slash:new M("forward_slash",E.token,"/"),bang:new M("bang",E.token,"!"),bracket_left:new M("bracket_left",E.token,"["),bracket_right:new M("bracket_right",E.token,"]"),brace_left:new M("brace_left",E.token,"{"),brace_right:new M("brace_right",E.token,"}"),colon:new M("colon",E.token,":"),comma:new M("comma",E.token,","),equal:new M("equal",E.token,"="),equal_equal:new M("equal_equal",E.token,"=="),not_equal:new M("not_equal",E.token,"!="),greater_than:new M("greater_than",E.token,">"),greater_than_equal:new M("greater_than_equal",E.token,">="),shift_right:new M("shift_right",E.token,">>"),less_than:new M("less_than",E.token,"<"),less_than_equal:new M("less_than_equal",E.token,"<="),shift_left:new M("shift_left",E.token,"<<"),modulo:new M("modulo",E.token,"%"),minus:new M("minus",E.token,"-"),minus_minus:new M("minus_minus",E.token,"--"),period:new M("period",E.token,"."),plus:new M("plus",E.token,"+"),plus_plus:new M("plus_plus",E.token,"++"),or:new M("or",E.token,"|"),or_or:new M("or_or",E.token,"||"),paren_left:new M("paren_left",E.token,"("),paren_right:new M("paren_right",E.token,")"),semicolon:new M("semicolon",E.token,";"),star:new M("star",E.token,"*"),tilde:new M("tilde",E.token,"~"),underscore:new M("underscore",E.token,"_"),xor:new M("xor",E.token,"^"),plus_equal:new M("plus_equal",E.token,"+="),minus_equal:new M("minus_equal",E.token,"-="),times_equal:new M("times_equal",E.token,"*="),division_equal:new M("division_equal",E.token,"/="),modulo_equal:new M("modulo_equal",E.token,"%="),and_equal:new M("and_equal",E.token,"&="),or_equal:new M("or_equal",E.token,"|="),xor_equal:new M("xor_equal",E.token,"^="),shift_right_equal:new M("shift_right_equal",E.token,">>="),shift_left_equal:new M("shift_left_equal",E.token,"<<=")};_.simpleTokens={"@":A.tokens.attr,"{":A.tokens.brace_left,"}":A.tokens.brace_right,":":A.tokens.colon,",":A.tokens.comma,"(":A.tokens.paren_left,")":A.tokens.paren_right,";":A.tokens.semicolon};_.literalTokens={"&":A.tokens.and,"&&":A.tokens.and_and,"->":A.tokens.arrow,"/":A.tokens.forward_slash,"!":A.tokens.bang,"[":A.tokens.bracket_left,"]":A.tokens.bracket_right,"=":A.tokens.equal,"==":A.tokens.equal_equal,"!=":A.tokens.not_equal,">":A.tokens.greater_than,">=":A.tokens.greater_than_equal,">>":A.tokens.shift_right,"<":A.tokens.less_than,"<=":A.tokens.less_than_equal,"<<":A.tokens.shift_left,"%":A.tokens.modulo,"-":A.tokens.minus,"--":A.tokens.minus_minus,".":A.tokens.period,"+":A.tokens.plus,"++":A.tokens.plus_plus,"|":A.tokens.or,"||":A.tokens.or_or,"*":A.tokens.star,"~":A.tokens.tilde,_:A.tokens.underscore,"^":A.tokens.xor,"+=":A.tokens.plus_equal,"-=":A.tokens.minus_equal,"*=":A.tokens.times_equal,"/=":A.tokens.division_equal,"%=":A.tokens.modulo_equal,"&=":A.tokens.and_equal,"|=":A.tokens.or_equal,"^=":A.tokens.xor_equal,">>=":A.tokens.shift_right_equal,"<<=":A.tokens.shift_left_equal};_.regexTokens={decimal_float_literal:A.tokens.decimal_float_literal,hex_float_literal:A.tokens.hex_float_literal,int_literal:A.tokens.int_literal,uint_literal:A.tokens.uint_literal,ident:A.tokens.ident};_.storage_class=[A.keywords.function,A.keywords.private,A.keywords.workgroup,A.keywords.uniform,A.keywords.storage];_.access_mode=[A.keywords.read,A.keywords.write,A.keywords.read_write];_.sampler_type=[A.keywords.sampler,A.keywords.sampler_comparison];_.sampled_texture_type=[A.keywords.texture_1d,A.keywords.texture_2d,A.keywords.texture_2d_array,A.keywords.texture_3d,A.keywords.texture_cube,A.keywords.texture_cube_array];_.multisampled_texture_type=[A.keywords.texture_multisampled_2d];_.storage_texture_type=[A.keywords.texture_storage_1d,A.keywords.texture_storage_2d,A.keywords.texture_storage_2d_array,A.keywords.texture_storage_3d];_.depth_texture_type=[A.keywords.texture_depth_2d,A.keywords.texture_depth_2d_array,A.keywords.texture_depth_cube,A.keywords.texture_depth_cube_array,A.keywords.texture_depth_multisampled_2d];_.texture_external_type=[A.keywords.texture_external];_.any_texture_type=[...A.sampled_texture_type,...A.multisampled_texture_type,...A.storage_texture_type,...A.depth_texture_type,...A.texture_external_type];_.texel_format=[A.keywords.r8unorm,A.keywords.r8snorm,A.keywords.r8uint,A.keywords.r8sint,A.keywords.r16uint,A.keywords.r16sint,A.keywords.r16float,A.keywords.rg8unorm,A.keywords.rg8snorm,A.keywords.rg8uint,A.keywords.rg8sint,A.keywords.r32uint,A.keywords.r32sint,A.keywords.r32float,A.keywords.rg16uint,A.keywords.rg16sint,A.keywords.rg16float,A.keywords.rgba8unorm,A.keywords.rgba8unorm_srgb,A.keywords.rgba8snorm,A.keywords.rgba8uint,A.keywords.rgba8sint,A.keywords.bgra8unorm,A.keywords.bgra8unorm_srgb,A.keywords.rgb10a2unorm,A.keywords.rg11b10float,A.keywords.rg32uint,A.keywords.rg32sint,A.keywords.rg32float,A.keywords.rgba16uint,A.keywords.rgba16sint,A.keywords.rgba16float,A.keywords.rgba32uint,A.keywords.rgba32sint,A.keywords.rgba32float];_.const_literal=[A.tokens.int_literal,A.tokens.uint_literal,A.tokens.decimal_float_literal,A.tokens.hex_float_literal,A.keywords.true,A.keywords.false];_.literal_or_ident=[A.tokens.ident,A.tokens.int_literal,A.tokens.uint_literal,A.tokens.decimal_float_literal,A.tokens.hex_float_literal];_.element_count_expression=[A.tokens.int_literal,A.tokens.uint_literal,A.tokens.ident];_.template_types=[A.keywords.vec2,A.keywords.vec3,A.keywords.vec4,A.keywords.mat2x2,A.keywords.mat2x3,A.keywords.mat2x4,A.keywords.mat3x2,A.keywords.mat3x3,A.keywords.mat3x4,A.keywords.mat4x2,A.keywords.mat4x3,A.keywords.mat4x4,A.keywords.atomic,A.keywords.bitcast,...A.any_texture_type];_.attribute_name=[A.tokens.ident,A.keywords.block,A.keywords.diagnostic];_.assignment_operators=[A.tokens.equal,A.tokens.plus_equal,A.tokens.minus_equal,A.tokens.times_equal,A.tokens.division_equal,A.tokens.modulo_equal,A.tokens.and_equal,A.tokens.or_equal,A.tokens.xor_equal,A.tokens.shift_right_equal,A.tokens.shift_left_equal];_.increment_operators=[A.tokens.plus_plus,A.tokens.minus_minus];class ws{constructor(e,t,n){this.type=e,this.lexeme=t,this.line=n}toString(){return this.lexeme}isTemplateType(){return _.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==_.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class _a{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new ws(_.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let x=1;for(;x>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),x--,x==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),x++)}return!0}}const t=_.simpleTokens[e];if(t)return this._addToken(t),!0;let n=_.none;const a=this._isAlpha(e),p=e==="_";if(this._isAlphaNumeric(e)){let x=this._peekAhead();for(;this._isAlphaNumeric(x);)e+=this._advance(),x=this._peekAhead()}if(a){const x=_.keywords[e];if(x)return this._addToken(x),!0}if(a||p)return this._addToken(_.tokens.ident),!0;for(;;){let x=this._findType(e);const S=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(S=="=")return this._current++,e+=S,this._addToken(_.tokens.minus_equal),!0;if(S=="-")return this._current++,e+=S,this._addToken(_.tokens.minus_minus),!0;const O=this._tokens.length-1;if((_.literal_or_ident.indexOf(this._tokens[O].type)!=-1||this._tokens[O].type==_.tokens.paren_right)&&S!=">")return this._addToken(x),!0}if(e==">"&&(S==">"||S=="=")){let O=!1,B=this._tokens.length-1;for(let I=0;I<5&&B>=0&&_.assignment_operators.indexOf(this._tokens[B].type)===-1;++I,--B)if(this._tokens[B].type===_.tokens.less_than){B>0&&this._tokens[B-1].isArrayOrTemplateType()&&(O=!0);break}if(O)return this._addToken(x),!0}if(x===_.none){let O=e,B=0;const I=2;for(let V=0;V<I;++V)if(O+=this._peekAhead(V),x=this._findType(O),x!==_.none){B=V;break}if(x===_.none)return n===_.none?!1:(this._current--,this._addToken(n),!0);e=O,this._current+=B+1}if(n=x,this._isAtEnd())break;e+=this._advance()}return n===_.none?!1:(this._addToken(n),!0)}_findType(e){for(const n in _.regexTokens){const a=_.regexTokens[n];if(this._match(e,a.rule))return a}return _.literalTokens[e]||_.none}_match(e,t){const n=t.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new ws(e,t,this._line))}}class ma{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new qi,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;t.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const a=n.arrayType,p=n.countNode;if(p instanceof qn){const x=p.name,S=this._context.constants.get(x);if(S)try{const O=S.evaluate(this._context);a.count=O}catch{}}}this._deferArrayCountEval.length=0}return t}_initialize(e){if(e)if(typeof e=="string"){const t=new _a(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,t){return{token:e,message:t,toString:function(){return`${t}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==_.eof}_match(e){if(e instanceof M)return this._check(e)?(this._advance(),!0):!1;for(let t=0,n=e.length;t<n;++t){const a=e[t];if(this._check(a))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),t)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;return e.indexOf(n)!=-1}return t.type==e}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(_.tokens.semicolon)&&!this._isAtEnd(););if(this._match(_.keywords.alias)){const t=this._type_alias();return this._consume(_.tokens.semicolon,"Expected ';'"),t}if(this._match(_.keywords.diagnostic)){const t=this._diagnostic();return this._consume(_.tokens.semicolon,"Expected ';'"),t}if(this._match(_.keywords.requires)){const t=this._requires_directive();return this._consume(_.tokens.semicolon,"Expected ';'"),t}if(this._match(_.keywords.enable)){const t=this._enable_directive();return this._consume(_.tokens.semicolon,"Expected ';'"),t}const e=this._attribute();if(this._check(_.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(_.tokens.semicolon,"Expected ';'."),t}if(this._check(_.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(_.tokens.semicolon,"Expected ';'."),t}if(this._check(_.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(_.tokens.semicolon,"Expected ';'."),t}if(this._check(_.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(_.tokens.semicolon,"Expected ';'."),t}if(this._check(_.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),t}if(this._check(_.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),t}return null}_function_decl(){if(!this._match(_.keywords.fn))return null;const e=this._currentLine,t=this._consume(_.tokens.ident,"Expected function name.").toString();this._consume(_.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(_.tokens.paren_right))do{if(this._check(_.tokens.paren_right))break;const S=this._attribute(),O=this._consume(_.tokens.ident,"Expected argument name.").toString();this._consume(_.tokens.colon,"Expected ':' for argument type.");const B=this._attribute(),I=this._type_decl();I!=null&&(I.attributes=B,n.push(new la(O,I,S)))}while(this._match(_.tokens.comma));this._consume(_.tokens.paren_right,"Expected ')' after function arguments.");let a=null;if(this._match(_.tokens.arrow)){const S=this._attribute();a=this._type_decl(),a!=null&&(a.attributes=S)}const p=this._compound_statement(),x=this._currentLine;return new Gn(t,n,a,p,e,x)}_compound_statement(){const e=[];for(this._consume(_.tokens.brace_left,"Expected '{' for block.");!this._check(_.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(_.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(_.tokens.semicolon)&&!this._isAtEnd(););if(this._check(_.tokens.attr)&&this._attribute(),this._check(_.keywords.if))return this._if_statement();if(this._check(_.keywords.switch))return this._switch_statement();if(this._check(_.keywords.loop))return this._loop_statement();if(this._check(_.keywords.for))return this._for_statement();if(this._check(_.keywords.while))return this._while_statement();if(this._check(_.keywords.continuing))return this._continuing_statement();if(this._check(_.keywords.static_assert))return this._static_assert_statement();if(this._check(_.tokens.brace_left))return this._compound_statement();let e=null;return this._check(_.keywords.return)?e=this._return_statement():this._check([_.keywords.var,_.keywords.let,_.keywords.const])?e=this._variable_statement():this._match(_.keywords.discard)?e=new ta:this._match(_.keywords.break)?e=new ra:this._match(_.keywords.continue)?e=new na:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(_.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(_.keywords.static_assert))return null;const e=this._optional_paren_expression();return new Vi(e)}_while_statement(){if(!this._match(_.keywords.while))return null;const e=this._optional_paren_expression();this._check(_.tokens.attr)&&this._attribute();const t=this._compound_statement();return new zi(e,t)}_continuing_statement(){if(!this._match(_.keywords.continuing))return null;const e=this._compound_statement();return new Wi(e)}_for_statement(){if(!this._match(_.keywords.for))return null;this._consume(_.tokens.paren_left,"Expected '('.");const e=this._check(_.tokens.semicolon)?null:this._for_init();this._consume(_.tokens.semicolon,"Expected ';'.");const t=this._check(_.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(_.tokens.semicolon,"Expected ';'.");const n=this._check(_.tokens.paren_right)?null:this._for_increment();this._consume(_.tokens.paren_right,"Expected ')'."),this._check(_.tokens.attr)&&this._attribute();const a=this._compound_statement();return new $i(e,t,n,a)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(_.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(_.tokens.equal)&&(t=this._short_circuit_or_expression()),new Qt(e.name,e.type,e.storage,e.access,t)}if(this._match(_.keywords.let)){const e=this._consume(_.tokens.ident,"Expected name for let.").toString();let t=null;if(this._match(_.tokens.colon)){const a=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=a)}this._consume(_.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return new Ln(e,t,null,null,n)}if(this._match(_.keywords.const)){const e=this._consume(_.tokens.ident,"Expected name for const.").toString();let t=null;if(this._match(_.tokens.colon)){const a=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=a)}this._consume(_.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return new _s(e,t,null,null,n)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(_.increment_operators))return this._current=e,null;const n=this._consume(_.increment_operators,"Expected increment operator");return new Xi(n.type===_.tokens.plus_plus?Cr.increment:Cr.decrement,t)}_assignment_statement(){let e=null;if(this._check(_.tokens.brace_right))return null;let t=this._match(_.tokens.underscore);if(t||(e=this._unary_expression()),!t&&e==null)return null;const n=this._consume(_.assignment_operators,"Expected assignment operator."),a=this._short_circuit_or_expression();return new Yi(rn.parse(n.lexeme),e,a)}_func_call_statement(){if(!this._check(_.tokens.ident))return null;const e=this._current,t=this._consume(_.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=e,null):new js(t.lexeme,n)}_loop_statement(){if(!this._match(_.keywords.loop))return null;this._check(_.tokens.attr)&&this._attribute(),this._consume(_.tokens.brace_left,"Expected '{' for loop.");const e=[];let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let a of t)e.push(a);else e.push(t);t=this._statement()}let n=null;return this._match(_.keywords.continuing)&&(n=this._compound_statement()),this._consume(_.tokens.brace_right,"Expected '}' for loop."),new Hi(e,n)}_switch_statement(){if(!this._match(_.keywords.switch))return null;const e=this._optional_paren_expression();this._check(_.tokens.attr)&&this._attribute(),this._consume(_.tokens.brace_left,"Expected '{' for switch.");const t=this._switch_body();if(t==null||t.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(_.tokens.brace_right,"Expected '}' for switch."),new Qi(e,t)}_switch_body(){const e=[];if(this._match(_.keywords.case)){const t=this._case_selectors();this._match(_.tokens.colon),this._check(_.tokens.attr)&&this._attribute(),this._consume(_.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(_.tokens.brace_right,"Exected '}' for switch case."),e.push(new ua(t,n))}if(this._match(_.keywords.default)){this._match(_.tokens.colon),this._check(_.tokens.attr)&&this._attribute(),this._consume(_.tokens.brace_left,"Exected '{' for switch default.");const t=this._case_body();this._consume(_.tokens.brace_right,"Exected '}' for switch default."),e.push(new ha(t))}if(this._check([_.keywords.default,_.keywords.case])){const t=this._switch_body();e.push(t[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(_.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(_.keywords.fallthrough))return this._consume(_.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(_.keywords.if))return null;const e=this._optional_paren_expression();this._check(_.tokens.attr)&&this._attribute();const t=this._compound_statement();let n=[];this._match_elseif()&&(this._check(_.tokens.attr)&&this._attribute(),n=this._elseif_statement(n));let a=null;return this._match(_.keywords.else)&&(this._check(_.tokens.attr)&&this._attribute(),a=this._compound_statement()),new Zi(e,t,n,a)}_match_elseif(){return this._tokens[this._current].type===_.keywords.else&&this._tokens[this._current+1].type===_.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(new da(t,n)),this._match_elseif()&&(this._check(_.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(_.keywords.return))return null;const e=this._short_circuit_or_expression();return new ji(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(_.tokens.or_or);)e=new lt(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(_.tokens.and_and);)e=new lt(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(_.tokens.or);)e=new lt(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(_.tokens.xor);)e=new lt(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(_.tokens.and);)e=new lt(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([_.tokens.equal_equal,_.tokens.not_equal])?new lt(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([_.tokens.less_than,_.tokens.greater_than,_.tokens.less_than_equal,_.tokens.greater_than_equal]);)e=new lt(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([_.tokens.shift_left,_.tokens.shift_right]);)e=new lt(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([_.tokens.plus,_.tokens.minus]);)e=new lt(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([_.tokens.star,_.tokens.forward_slash,_.tokens.modulo]);)e=new lt(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([_.tokens.minus,_.tokens.bang,_.tokens.tilde,_.tokens.star,_.tokens.and])?new ca(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(_.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(_.tokens.bracket_right,"Expected ']'.");const t=new oa(e),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(_.tokens.period)){const e=this._consume(_.tokens.ident,"Expected member name."),t=this._postfix_expression(),n=new ia(e.lexeme);return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(_.tokens.ident)){const n=this._previous().toString();if(this._check(_.tokens.paren_left)){const a=this._argument_expression_list(),p=this._getStruct(n);return p!=null?new gr(p,a):new ti(n,a)}if(this._context.constants.has(n)){const a=this._context.constants.get(n);return new ms(n,a.value)}return new qn(n)}if(this._match(_.const_literal))return new gs(parseFloat(this._previous().toString()));if(this._check(_.tokens.paren_left))return this._paren_expression();if(this._match(_.keywords.bitcast)){this._consume(_.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(_.tokens.greater_than,"Expected '>'.");const a=this._paren_expression();return new aa(n,a)}const e=this._type_decl(),t=this._argument_expression_list();return new gr(e,t)}_argument_expression_list(){if(!this._match(_.tokens.paren_left))return null;const e=[];do{if(this._check(_.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(_.tokens.comma));return this._consume(_.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(_.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(_.tokens.paren_right),new ys([e])}_paren_expression(){this._consume(_.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(_.tokens.paren_right,"Expected ')'."),new ys([e])}_struct_decl(){if(!this._match(_.keywords.struct))return null;const e=this._currentLine,t=this._consume(_.tokens.ident,"Expected name for struct.").toString();this._consume(_.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(_.tokens.brace_right);){const x=this._attribute(),S=this._consume(_.tokens.ident,"Expected variable name.").toString();this._consume(_.tokens.colon,"Expected ':' for struct member type.");const O=this._attribute(),B=this._type_decl();B!=null&&(B.attributes=O),this._check(_.tokens.brace_right)?this._match(_.tokens.comma):this._consume(_.tokens.comma,"Expected ',' for struct member."),n.push(new fa(S,B,x))}this._consume(_.tokens.brace_right,"Expected '}' after struct body.");const a=this._currentLine,p=new Vt(t,n,e,a);return this._context.structs.set(t,p),p}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(_.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(_.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(_.keywords.const))return null;const e=this._consume(_.tokens.ident,"Expected variable name");let t=null;if(this._match(_.tokens.colon)){const p=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=p)}let n=null;if(this._match(_.tokens.equal)){const p=this._short_circuit_or_expression();if(p instanceof gr)n=p;else if(p instanceof ms&&p.initializer instanceof gr)n=p.initializer;else try{const x=p.evaluate(this._context);n=new gs(x)}catch{n=p}}const a=new _s(e.toString(),t,"","",n);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(_.keywords.let))return null;const e=this._consume(_.tokens.ident,"Expected variable name");let t=null;if(this._match(_.tokens.colon)){const a=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=a)}let n=null;return this._match(_.tokens.equal)&&(n=this._const_expression()),new Ln(e.toString(),t,"","",n)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(_.keywords.var))return null;let e="",t="";this._match(_.tokens.less_than)&&(e=this._consume(_.storage_class,"Expected storage_class.").toString(),this._match(_.tokens.comma)&&(t=this._consume(_.access_mode,"Expected access_mode.").toString()),this._consume(_.tokens.greater_than,"Expected '>'."));const n=this._consume(_.tokens.ident,"Expected variable name");let a=null;if(this._match(_.tokens.colon)){const p=this._attribute();a=this._type_decl(),a!=null&&(a.attributes=p)}return new Qt(n.toString(),a,e,t,null)}_override_decl(){if(!this._match(_.keywords.override))return null;const e=this._consume(_.tokens.ident,"Expected variable name");let t=null;if(this._match(_.tokens.colon)){const n=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=n)}return new Zs(e.toString(),t,null)}_diagnostic(){this._consume(_.tokens.paren_left,"Expected '('");const e=this._consume(_.tokens.ident,"Expected severity control name.");this._consume(_.tokens.comma,"Expected ','");const t=this._consume(_.tokens.ident,"Expected diagnostic rule name.");return this._consume(_.tokens.paren_right,"Expected ')'"),new ea(e.toString(),t.toString())}_enable_directive(){const e=this._consume(_.tokens.ident,"identity expected.");return new Ji(e.toString())}_requires_directive(){const e=[this._consume(_.tokens.ident,"identity expected.").toString()];for(;this._match(_.tokens.comma);){const t=this._consume(_.tokens.ident,"identity expected.");e.push(t.toString())}return new Ki(e)}_type_alias(){const e=this._consume(_.tokens.ident,"identity expected.");this._consume(_.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=new Js(e.toString(),t);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([_.tokens.ident,..._.texel_format,_.keywords.bool,_.keywords.f32,_.keywords.i32,_.keywords.u32])){const n=this._advance(),a=n.toString();return this._context.structs.has(a)?this._context.structs.get(a):this._context.aliases.has(a)?this._context.aliases.get(a).type:new cr(n.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(_.template_types)){let n=this._advance().toString(),a=null,p=null;return this._match(_.tokens.less_than)&&(a=this._type_decl(),p=null,this._match(_.tokens.comma)&&(p=this._consume(_.access_mode,"Expected access_mode for pointer").toString()),this._consume(_.tokens.greater_than,"Expected '>' for type.")),new Ks(n,a,p)}if(this._match(_.keywords.ptr)){let n=this._previous().toString();this._consume(_.tokens.less_than,"Expected '<' for pointer.");const a=this._consume(_.storage_class,"Expected storage_class for pointer");this._consume(_.tokens.comma,"Expected ',' for pointer.");const p=this._type_decl();let x=null;return this._match(_.tokens.comma)&&(x=this._consume(_.access_mode,"Expected access_mode for pointer").toString()),this._consume(_.tokens.greater_than,"Expected '>' for pointer."),new sa(n,a.toString(),p,x)}const t=this._attribute();if(this._match(_.keywords.array)){let n=null,a=-1;const p=this._previous();let x=null;if(this._match(_.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let O="";if(this._match(_.tokens.comma)){x=this._shift_expression();try{O=x.evaluate(this._context).toString(),x=null}catch{O="1"}}this._consume(_.tokens.greater_than,"Expected '>' for array."),a=O?parseInt(O):0}const S=new ei(p.toString(),t,n,a);return x&&this._deferArrayCountEval.push({arrayType:S,countNode:x}),S}return null}_texture_sampler_types(){if(this._match(_.sampler_type))return new Dr(this._previous().toString(),null,null);if(this._match(_.depth_texture_type))return new Dr(this._previous().toString(),null,null);if(this._match(_.sampled_texture_type)||this._match(_.multisampled_texture_type)){const e=this._previous();this._consume(_.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(_.tokens.greater_than,"Expected '>' for sampler type."),new Dr(e.toString(),t,null)}if(this._match(_.storage_texture_type)){const e=this._previous();this._consume(_.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(_.texel_format,"Invalid texel format.").toString();this._consume(_.tokens.comma,"Expected ',' after texel format.");const n=this._consume(_.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(_.tokens.greater_than,"Expected '>' for sampler type."),new Dr(e.toString(),t,n)}return null}_attribute(){let e=[];for(;this._match(_.tokens.attr);){const t=this._consume(_.attribute_name,"Expected attribute name"),n=new pa(t.toString(),null);if(this._match(_.tokens.paren_left)){if(n.value=this._consume(_.literal_or_ident,"Expected attribute value").toString(),this._check(_.tokens.comma)){this._advance();do{const a=this._consume(_.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(a)}while(this._match(_.tokens.comma))}this._consume(_.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class Ar{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class ks{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class fn extends Ar{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Dn extends Ar{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}}class xs extends Ar{constructor(e,t,n,a){super(e,n),this.format=t,this.access=a}get isTemplate(){return!0}}var Rt;(function(i){i[i.Uniform=0]="Uniform",i[i.Storage=1]="Storage",i[i.Texture=2]="Texture",i[i.Sampler=3]="Sampler",i[i.StorageTexture=4]="StorageTexture"})(Rt||(Rt={}));class pn{constructor(e,t,n,a,p,x,S){this.name=e,this.type=t,this.group=n,this.binding=a,this.attributes=p,this.resourceType=x,this.access=S}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ga{constructor(e,t){this.name=e,this.type=t}}class _n{constructor(e,t){this.align=e,this.size=t}}class ya{constructor(e,t,n,a){this.name=e,this.type=t,this.locationType=n,this.location=a,this.interpolation=null}}class vs{constructor(e,t,n,a){this.name=e,this.type=t,this.locationType=n,this.location=a}}class wa{constructor(e,t,n,a){this.name=e,this.type=t,this.attributes=n,this.id=a}}class ka{constructor(e,t){this.name=e,this.type=t}}class xa{constructor(e,t=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t}}class va{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class ba{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Et{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new va,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const t=new ma().parse(e);for(const n of t)n instanceof Gn&&this._functions.set(n.name,new ba(n));for(const n of t)if(n instanceof Vt){const a=this._getTypeInfo(n,null);a instanceof fn&&this.structs.push(a)}for(const n of t){if(n instanceof Js){this.aliases.push(this._getAliasInfo(n));continue}if(n instanceof Zs){const a=n,p=this._getAttributeNum(a.attributes,"id",0),x=a.type!=null?this._getTypeInfo(a.type,a.attributes):null;this.overrides.push(new wa(a.name,x,a.attributes,p));continue}if(this._isUniformVar(n)){const a=n,p=this._getAttributeNum(a.attributes,"group",0),x=this._getAttributeNum(a.attributes,"binding",0),S=this._getTypeInfo(a.type,a.attributes),O=new pn(a.name,S,p,x,a.attributes,Rt.Uniform,a.access);this.uniforms.push(O);continue}if(this._isStorageVar(n)){const a=n,p=this._getAttributeNum(a.attributes,"group",0),x=this._getAttributeNum(a.attributes,"binding",0),S=this._getTypeInfo(a.type,a.attributes),O=this._isStorageTexture(S),B=new pn(a.name,S,p,x,a.attributes,O?Rt.StorageTexture:Rt.Storage,a.access);this.storage.push(B);continue}if(this._isTextureVar(n)){const a=n,p=this._getAttributeNum(a.attributes,"group",0),x=this._getAttributeNum(a.attributes,"binding",0),S=this._getTypeInfo(a.type,a.attributes),O=this._isStorageTexture(S),B=new pn(a.name,S,p,x,a.attributes,O?Rt.StorageTexture:Rt.Texture,a.access);O?this.storage.push(B):this.textures.push(B);continue}if(this._isSamplerVar(n)){const a=n,p=this._getAttributeNum(a.attributes,"group",0),x=this._getAttributeNum(a.attributes,"binding",0),S=this._getTypeInfo(a.type,a.attributes),O=new pn(a.name,S,p,x,a.attributes,Rt.Sampler,a.access);this.samplers.push(O);continue}if(n instanceof Gn){const a=this._getAttribute(n,"vertex"),p=this._getAttribute(n,"fragment"),x=this._getAttribute(n,"compute"),S=a||p||x,O=new xa(n.name,S?.name);O.startLine=n.startLine,O.endLine=n.endLine,this.functions.push(O),this._functions.get(n.name).info=O,S?(this._functions.get(n.name).inUse=!0,O.inUse=!0,O.resources=this._findResources(n,!!S),O.inputs=this._getInputs(n.args),O.outputs=this._getOutputs(n.returnType),this.entry[S.name].push(O)):(O.arguments=n.args.map(B=>new ka(B.name,this._getTypeInfo(B.type,B.attributes))),O.returnType=n.returnType?this._getTypeInfo(n.returnType,n.attributes):null);continue}}for(const n of this._functions.values())n.info&&(n.info.inUse=n.inUse,this._addCalls(n.node,n.info.calls));for(const n of this._functions.values())n.node.search(a=>{var p;if(a.astNodeType==="varExpr"){const x=a;for(const S of this.overrides)x.name==S.name&&((p=n.info)===null||p===void 0||p.overrides.push(S))}});for(const n of this.uniforms)this._markStructsInUse(n.type);for(const n of this.storage)this._markStructsInUse(n.type)}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const a of e.calls){const p=(n=this._functions.get(a.name))===null||n===void 0?void 0:n.info;p&&t.add(p)}}findResource(e,t){for(const n of this.uniforms)if(n.group==e&&n.binding==t)return n;for(const n of this.storage)if(n.group==e&&n.binding==t)return n;for(const n of this.textures)if(n.group==e&&n.binding==t)return n;for(const n of this.samplers)if(n.group==e&&n.binding==t)return n;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this._getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],a=this,p=[];return e.search(x=>{if(x instanceof bn)p.push({});else if(x instanceof Tn)p.pop();else if(x instanceof Qt){const S=x;t&&S.type!==null&&this._markStructsFromAST(S.type),p.length>0&&(p[p.length-1][S.name]=S)}else if(x instanceof gr){const S=x;t&&S.type!==null&&this._markStructsFromAST(S.type)}else if(x instanceof Ln){const S=x;t&&S.type!==null&&this._markStructsFromAST(S.type),p.length>0&&(p[p.length-1][S.name]=S)}else if(x instanceof qn){const S=x;if(p.length>0&&p[p.length-1][S.name])return;const O=a._findResource(S.name);O&&n.push(O)}else if(x instanceof ti){const S=x,O=a._functions.get(S.name);O&&(t&&(O.inUse=!0),e.calls.add(O.node),O.resources===null&&(O.resources=a._findResources(O.node,t)),n.push(...O.resources))}else if(x instanceof js){const S=x,O=a._functions.get(S.name);O&&(t&&(O.inUse=!0),e.calls.add(O.node),O.resources===null&&(O.resources=a._findResources(O.node,t)),n.push(...O.resources))}}),[...new Map(n.map(x=>[x.name,x])).values()]}getBindGroups(){const e=[];function t(n,a){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),a>=e[n].length&&(e[n].length=a+1)}for(const n of this.uniforms){t(n.group,n.binding);const a=e[n.group];a[n.binding]=n}for(const n of this.storage){t(n.group,n.binding);const a=e[n.group];a[n.binding]=n}for(const n of this.textures){t(n.group,n.binding);const a=e[n.group];a[n.binding]=n}for(const n of this.samplers){t(n.group,n.binding);const a=e[n.group];a[n.binding]=n}return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof Vt)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);n!==null&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof Vt)this._getStructOutputs(n.type,t);else{const a=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(a!==null){const p=this._getTypeInfo(n.type,n.type.attributes),x=this._parseInt(a.value),S=new vs(n.name,p,a.name,x);t.push(S)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this._getTypeInfo(e,e.attributes),a=this._parseInt(t.value);return new vs("",n,t.name,a)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const n of e)if(n.type instanceof Vt)this._getStructInputs(n.type,t);else{const a=this._getInputInfo(n);a!==null&&t.push(a)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof Vt)this._getStructInputs(n.type,t);else{const a=this._getInputInfo(n);a!==null&&t.push(a)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this._getAttribute(e,"interpolation"),a=this._getTypeInfo(e.type,e.attributes),p=this._parseInt(t.value),x=new ya(e.name,a,t.name,p);return n!==null&&(x.interpolation=this._parseString(n.value)),x}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new ga(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,t){if(this._types.has(e))return this._types.get(e);if(e instanceof ei){const a=e,p=a.format?this._getTypeInfo(a.format,a.attributes):null,x=new Dn(a.name,t);return x.format=p,x.count=a.count,this._types.set(e,x),this._updateTypeInfo(x),x}if(e instanceof Vt){const a=e,p=new fn(a.name,t);p.startLine=a.startLine,p.endLine=a.endLine;for(const x of a.members){const S=this._getTypeInfo(x.type,x.attributes);p.members.push(new ks(x.name,S,x.attributes))}return this._types.set(e,p),this._updateTypeInfo(p),p}if(e instanceof Dr){const a=e,p=a.format instanceof cr,x=a.format?p?this._getTypeInfo(a.format,null):new Ar(a.format,null):null,S=new xs(a.name,x,t,a.access);return this._types.set(e,S),this._updateTypeInfo(S),S}if(e instanceof Ks){const a=e,p=a.format?this._getTypeInfo(a.format,null):null,x=new xs(a.name,p,t,a.access);return this._types.set(e,x),this._updateTypeInfo(x),x}const n=new Ar(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n;const a=this._getTypeSize(e);if(e.size=(t=a?.size)!==null&&t!==void 0?t:0,e instanceof Dn&&e.format){const p=this._getTypeSize(e.format);e.stride=(n=p?.size)!==null&&n!==void 0?n:0,this._updateTypeInfo(e.format)}e instanceof fn&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,a=0,p=0,x=0;for(let S=0,O=e.members.length;S<O;++S){const B=e.members[S],I=this._getTypeSize(B);if(!I)continue;(t=this._getAlias(B.type.name))!==null&&t!==void 0||B.type;const V=I.align,z=I.size;n=this._roundUp(V,n+a),a=z,p=n,x=Math.max(x,V),B.offset=n,B.size=z,this._updateTypeInfo(B.type)}e.size=this._roundUp(x,p+a),e.align=x}_getTypeSize(e){var t,n;if(e==null)return null;const a=this._getAttributeNum(e.attributes,"size",0),p=this._getAttributeNum(e.attributes,"align",0);if(e instanceof ks&&(e=e.type),e instanceof Ar){const x=this._getAlias(e.name);x!==null&&(e=x)}{const x=Et._typeInfo[e.name];if(x!==void 0){const S=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new _n(Math.max(p,x.align/S),Math.max(a,x.size/S))}}{const x=Et._typeInfo[e.name.substring(0,e.name.length-1)];if(x){const S=e.name[e.name.length-1]==="h"?2:1;return new _n(Math.max(p,x.align/S),Math.max(a,x.size/S))}}if(e instanceof Dn){let x=e,S=8,O=8;const B=this._getTypeSize(x.format);B!==null&&(O=B.size,S=B.align);const I=x.count,V=this._getAttributeNum((n=e?.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(S,O));return O=I*V,a&&(O=a),new _n(Math.max(p,S),Math.max(a,O))}if(e instanceof fn){let x=0,S=0,O=0,B=0,I=0;for(const V of e.members){const z=this._getTypeSize(V.type);z!==null&&(x=Math.max(z.align,x),O=this._roundUp(z.align,O+B),B=z.size,I=O)}return S=this._roundUp(x,I+B),new _n(Math.max(p,x),Math.max(a,S))}return null}_isUniformVar(e){return e instanceof Qt&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Qt&&e.storage=="storage"}_isTextureVar(e){return e instanceof Qt&&e.type!==null&&Et._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Qt&&e.type!==null&&Et._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const a=n.attributes;for(let p of a)if(p.name==t)return p;return null}_getAttributeNum(e,t,n){if(e===null)return n;for(let a of e)if(a.name==t){let p=a!==null&&a.value!==null?a.value:n;return p instanceof Array&&(p=p[0]),typeof p=="number"?p:typeof p=="string"?parseInt(p):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}Et._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};Et._textureTypes=_.any_texture_type.map(i=>i.name);Et._samplerTypes=_.sampler_type.map(i=>i.name);var yr,lr,zt,Wt,gn,yn,Fr,rr,Ke,Wr,dr,si;class ii{constructor(e,t,n){P(this,Ke),P(this,yr),P(this,lr),P(this,zt),ur(this,"Device"),ur(this,"BindGroups",[]),ur(this,"Reflect"),P(this,Wt),ur(this,"Pipeline"),ur(this,"Descriptor"),P(this,gn),P(this,yn),P(this,Fr),P(this,rr,[]),!e&&te(Y.DEVICE_NOT_REQUESTED),F(this,yr,n),this.Device=e,F(this,lr,t),F(this,zt,this.CreatePipelineLabel("Command Encoder"))}CreatePipelineLabel(e){return l(this,lr)&&e&&`${l(this,lr)} ${e}`||""}CreatePipelineLayout(e,t){t??(t=this.CreatePipelineLabel(`${l(this,yr)} Pipeline Layout`));const n=Array.isArray(e)&&e||[e];return this.Device.createPipelineLayout({label:t,bindGroupLayouts:n})}CreateTimestampWrites(e,t,n){return{querySet:e,beginningOfPassWriteIndex:t,endOfPassWriteIndex:n}}ResolveQuerySet(e,t,n=0,a=e.count,p=0){this.GetCommandEncoder(!0).resolveQuerySet(e,n,a,t,p)}CreateShaderModule(e,t,n,a){e||(e=Vs,It(Y.SHADER_CODE_NOT_FOUND)),t??(t=this.CreatePipelineLabel("Shader Module"));const p=Array.isArray(e)&&e.join(`

`)||e;return this.Reflect=new Et(p),this.Device.createShaderModule({label:t,code:p,sourceMap:n,compilationHints:a})}GetShaderModule(e){return e instanceof GPUShaderModule&&e||e.module}CreateBuffer(e){const t=e.label??this.CreatePipelineLabel("Buffer");return this.Device.createBuffer({label:t,...e})}CreateReadableBuffer(e){let t=typeof e=="number"&&e;t||(t=e.size);const n=e?.label??"Readable Buffer";return this.CreateBuffer({label:n,size:t,usage:Gt.READABLE,...e})}CreateWritableBuffer(e){let t=typeof e=="number"&&e;t||(t=e.size);const n=e?.label??"Writable Buffer";return this.CreateBuffer({label:n,size:t,usage:Gt.WRITABLE,...e})}CreateStorageBuffer(e,t=1){!this.Reflect&&te(Y.SHADER_MODULE_NOT_FOUND,"`CreateStorageBuffer`.\n            Use `CreateShaderModule` before creating a storage buffer.");const n=this.Reflect.storage.find(({name:I})=>e===I);!n&&te(Y.STORAGE_NOT_FOUND,`\`${e}\` in shader bindings.`);const a=typeof t=="number"&&t||t.length,p=t.label??`${e} Storage Buffer`,x=n.format.size*a,S=new ArrayBuffer(x),O=I=>(Object.keys(I).forEach(V=>{if(!(I[V].buffer instanceof ArrayBuffer))O(I[V]);else{const z=I[V].constructor,H=x/z.BYTES_PER_ELEMENT;I[V]=new z(S,0,H)}}),I),B=W(this,Ke,Wr).call(this,n,S);return{buffer:this.CreateBuffer({label:p,size:x,usage:Gt.STORAGE,...t}),[e]:B.buffer instanceof ArrayBuffer?new B.constructor(S,0,a):O(B)}}CreateUniformBuffer(e,t){!this.Reflect&&te(Y.SHADER_MODULE_NOT_FOUND,"`CreateUniformBuffer`.\n            Use `CreateShaderModule` before creating a uniform buffer.");const n=this.Reflect.uniforms.find(({name:x})=>e===x);!n&&te(Y.UNIFORM_NOT_FOUND,`\`${e}\` in shader uniforms.`),e==="resolution"&&It(Y.INVALID_UNIFORM_NAME,`\`${e}\`.`);const a=t?.label??`${e} Uniform Buffer`,p=new ArrayBuffer(n.size);return{buffer:this.CreateBuffer({label:a,size:p.byteLength,usage:Gt.UNIFORM,...t}),[e]:W(this,Ke,Wr).call(this,n,p)}}CreateUniformBufferLayout(e){!this.Reflect&&te(Y.SHADER_MODULE_NOT_FOUND,"`CreateUniformBufferLayout`.\n            Use `CreateShaderModule` before creating a uniform buffer layout.");const t=this.Reflect.uniforms.find(({name:n})=>e===n);return!t&&te(Y.UNIFORM_NOT_FOUND,`\`${e}\` in shader uniforms.`),e==="resolution"&&It(Y.INVALID_UNIFORM_NAME,`\`${e}\`.`),W(this,Ke,Wr).call(this,t,new ArrayBuffer(t.size))}WriteBuffer(e,t,n=0,a,p){this.Device.queue.writeBuffer(e,n,t,a,p)}CopyBufferToBuffer(e,t,n=t.size,a=0,p=0){this.GetCommandEncoder(!0).copyBufferToBuffer(e,a,t,p,n)}GetBufferMinBindingSize(e){!this.Reflect&&te(Y.SHADER_MODULE_NOT_FOUND,"`GetBufferMinBindingSize`.\n            Use `CreateShaderModule` before requesting buffer's min binding size.");const t=this.Reflect.getBindGroups().flat().find(({name:n})=>e===n);return t?.size??te(Y.BINDING_NOT_FOUND,`\`${e}\` in shader bind groups.`)}CreateBufferBindingLayout(e,t,n,a,p){return a??(a=W(this,Ke,dr).call(this)),{binding:p,visibility:a,buffer:{type:e,hasDynamicOffset:t,minBindingSize:n}}}CreateSamplerBindingLayout(e,t,n){return t??(t=W(this,Ke,dr).call(this)),{binding:n,visibility:t,sampler:{type:e}}}CreateTextureBindingLayout(e,t,n,a,p){return a??(a=W(this,Ke,dr).call(this)),{binding:p,visibility:a,texture:{sampleType:e,viewDimension:t,multisampled:n}}}CreateStorageTextureBindingLayout(e,t,n,a,p){return a??(a=W(this,Ke,dr).call(this)),{binding:p,visibility:a,storageTexture:{access:t,format:e,viewDimension:n}}}CreateExternalTextureBindingLayout(e,t){return e??(e=W(this,Ke,dr).call(this)),{binding:t,visibility:e,externalTexture:{}}}CreateBindGroupEntries(e,t=0){return Array.isArray(e)&&e.map((n,a)=>({binding:t?.[a]??a,resource:n}))||[{binding:t,resource:e}]}CreateBindGroupLayout(e,t){return t??(t=this.CreatePipelineLabel("Bind Group Layout")),e=Array.isArray(e)&&e.map((n,a)=>({...n,binding:n.binding??a}))||[{...e,binding:e.binding??0}],this.Device.createBindGroupLayout({entries:e,label:t})}CreateBindGroup(e,t=0,n){return n??(n=this.CreatePipelineLabel("Bind Group")),typeof t=="number"&&(t=this.Pipeline?this.Pipeline.getBindGroupLayout(t):te(Y.PIPELINE_NOT_FOUND,`${l(this,yr)}Pipeline.`)),this.Device.createBindGroup({entries:e,label:n,layout:t})}SetBindGroups(e,t){const n=Array.isArray(e),a=Array.isArray(t);t=n&&a?t.map(p=>Array.isArray(p)&&p||[p]):a&&t||t&&[t],t=t&&t||[],this.BindGroups=n&&e.map((p,x)=>({bindGroup:p,dynamicOffsets:t,active:!0}))||[{bindGroup:e,dynamicOffsets:t,active:!0}]}AddBindGroups(e,t){const n=Array.isArray(e),a=Array.isArray(t);return t=n&&a?t.map(p=>Array.isArray(p)&&p||[p]):a&&t||t&&[t],t=t&&t||[],this.BindGroups.push(...n&&e.map(p=>({bindGroup:p,dynamicOffsets:t,active:!0}))||[{bindGroup:e,dynamicOffsets:t,active:!0}])}SetActiveBindGroups(e){e=Array.isArray(e)&&e||[e];for(let t=this.BindGroups.length;t--;)this.BindGroups[t].active=e.includes(t)}ClearBindGroups(){this.BindGroups.splice(0)}GetBindGroupsInfo(){!this.Reflect&&te(Y.SHADER_MODULE_NOT_FOUND,"`GetBindGroupsInfo`.\n            Use `CreateShaderModule` before requesting bind groups information.");const e=this.BindGroups.length,t=new Array(e),n=this.Reflect.getBindGroups();for(let a=0;a<e;++a){const{bindGroup:{label:p},dynamicOffsets:x,active:S}=this.BindGroups[a];t[a]={label:p,isActive:S,dynamicOffsets:x,bindings:n[a]}}return t}CreateCommandEncoder(){return F(this,Wt,this.Device.createCommandEncoder({label:l(this,zt)}))}SetCommandEncoder(e){F(this,Wt,e)}GetCommandEncoder(e=!1){if(!l(this,Wt)){if(e){const t=`${l(this,zt)&&`Label: "${l(this,zt)}".`}`;It(Y.COMMAND_ENCODER_NOT_FOUND,` ${t} Creating a new one.`)}return this.CreateCommandEncoder()}return l(this,Wt)}SubmitCommandBuffer(){this.Device.queue.submit([l(this,Wt).finish()])}SetPipeline(e){return this.Pipeline=e}SavePipelineState(){F(this,Fr,this.Reflect),F(this,yn,this.Pipeline),F(this,gn,this.Descriptor),F(this,rr,[...this.BindGroups])}ResetPipelineState(){this.ClearBindGroups()}RestorePipelineState(){this.Descriptor=l(this,gn),this.SetPipeline(l(this,yn)),this.Reflect=l(this,Fr),W(this,Ke,si).call(this)}set CommandEncoderLabel(e){F(this,zt,e)}get ProgramName(){return l(this,lr)}Destroy(){this.ResetPipelineState(),F(this,Fr,void 0),l(this,rr).splice(0),this.SetCommandEncoder(void 0)}}yr=new WeakMap,lr=new WeakMap,zt=new WeakMap,Wt=new WeakMap,gn=new WeakMap,yn=new WeakMap,Fr=new WeakMap,rr=new WeakMap,Ke=new WeakSet,Wr=function(i,e,t=0,n=[]){const{format:a}=i.type,p=i.type.members??a?.members;let x=t+(i.offset??0);if(p)for(let S=0,O={},B=a?.isStruct&&i.count||1;S<B;++S)p.forEach(I=>O[I.name]=W(this,Ke,Wr).call(this,I,e,x)),a!=null&&a.isStruct&&(x+=i.stride),n.push(O);else{const S=Ii((a??i.type).name),O=i.size/Gi(S),B=Li(S);return new B(e,x,O)}return n.length===1&&n[0]||n},dr=function(){return l(this,yr)==="Render"&&GPUShaderStage.FRAGMENT||GPUShaderStage.COMPUTE},si=function(){const i=l(this,rr).map(({bindGroup:a})=>a),e=l(this,rr).map(({dynamicOffsets:a})=>a),t=e.some(a=>typeof a=="number")&&e||void 0,n=l(this,rr).map(({active:a},p)=>a&&p).filter(a=>typeof a=="number");this.SetBindGroups(i,t),this.SetActiveBindGroups(n)};var wn,Nt,$r,$t,ye,Ot,wr,kr,ct,pt,ge,at,fr,Ct,_t,Xt,Pr,Br,Ir,pr,mt,vt,Vn,zn,Wn,ai;class Ta extends ii{constructor(e,t,n,a){super(e,t,"Render"),P(this,vt),P(this,wn),P(this,Nt,!1),P(this,$r,new Float32Array(2)),P(this,$t,!1),P(this,ye),P(this,Ot),P(this,wr),P(this,kr),P(this,ct),P(this,pt),P(this,ge),P(this,at),P(this,fr),P(this,Ct,[0,0,0,0]),P(this,_t,[]),P(this,Xt),P(this,Pr),P(this,Br),P(this,Ir,[0,0,0,0]),P(this,pr),P(this,mt),!n&&te(Y.CANVAS_NOT_FOUND);const p=n.getContext("webgpu");!p&&te(Y.CONTEXT_NOT_FOUND),p.configure({device:e,...a}),F(this,wr,this.CreateBuffer({size:l(this,$r).length*Float32Array.BYTES_PER_ELEMENT,label:"Render Pipeline Resolution Buffer",usage:Gt.UNIFORM})),F(this,ye,n),F(this,Ot,p),W(this,vt,Vn).call(this),F(this,fr,a.format),this.CreatePassDescriptor(this.CreateColorAttachment())}ConfigureContext(e){const t=e.format??l(this,fr);l(this,Ot).configure({device:this.Device,format:t,...e})}CreateColorAttachment(e,t="clear",n="store",a,p,x){const S=a&&W(this,vt,zn).call(this,a);return{view:e,loadOp:t,storeOp:n,clearValue:S,resolveTarget:p,depthSlice:x}}CreateDepthAttachment(e,t=1,n="clear",a="store",p){return F(this,$t,!0),F(this,kr,new Ys(this.Device)),{view:e,depthClearValue:t,depthLoadOp:n,depthStoreOp:a,depthReadOnly:p}}CreateStencilAttachment(e,t="clear",n="store",a){return{stencilClearValue:e,stencilLoadOp:t,stencilStoreOp:n,stencilReadOnly:a}}CreatePassDescriptor(e,t,n,a,p,x){const S=Array.isArray(e)&&e||[e];return F(this,Nt,!S.some(({view:O})=>!!O)),t??(t=this.CreatePipelineLabel("Render Pass")),this.Descriptor={colorAttachments:S,depthStencilAttachment:n,occlusionQuerySet:a,timestampWrites:p,maxDrawCount:x,label:t}}CreateIndexBuffer(e,t){const n=t?.label??"Index Buffer";return e=Array.isArray(e)&&new Uint32Array(e)||e,this.CreateBuffer({label:n,size:e.byteLength,usage:Gt.INDEX,...t})}CreateVertexBufferAttribute(e,t=0,n=0){return W(this,vt,Wn).call(this,e,t,n)}CreateVertexBufferLayout(e,t,n="vertex"){!this.Reflect&&te(Y.SHADER_MODULE_NOT_FOUND,"`Renderer.CreateVertexBufferLayout`.\n            Call `Renderer.CreateShaderModule` before creating a vertex layout or vertex buffer.");const{entry:{vertex:a}}=this.Reflect,p=a.find(({name:O})=>n===O);!p&&te(Y.VERTEX_ENTRY_NOT_FOUND,`\`${n}\` in vertex shader entries.`),e=Array.isArray(e)&&e||[e];let x=[],S=0;for(let O=0,B=e.length;O<B;++O){const I=e[O],V=typeof I=="string",z=V?I:I.name,H=p.inputs.find(({name:re})=>z===re);if(H){const re=V?Pi(H.type.size):I.format;x.push(W(this,vt,Wn).call(this,re,+H.location,S)),S+=Bi(re);continue}It(Y.VERTEX_ATTRIBUTE_NOT_FOUND,`\`${z}\` in vertex shader inputs.`)}return{arrayStride:S,stepMode:t,attributes:x}}CreateVertexBuffer(e,t=1,n,a="vertex"){const p=t.label??"Vertex Buffer";if(e instanceof Float32Array)return this.CreateBuffer({label:p,size:e.byteLength,usage:Gt.VERTEX,...t});const x=this.CreateVertexBufferLayout(e,n,a),S=(typeof t=="number"&&t||(t.count??1))*x.arrayStride;return{buffer:this.CreateBuffer({label:p,size:S,usage:Gt.VERTEX,...t}),layout:x}}CreateVertexState(e,t="vertex",n,a){return n=Array.isArray(n)&&n||[n],{module:e,entryPoint:t,buffers:n,constants:a}}CreateBlendComponent(e="add",t="one",n="zero"){return{operation:e,srcFactor:t,dstFactor:n}}CreateTargetState(e=l(this,fr),t,n){return t&&(t={color:t.color??{},alpha:t.alpha??{}}),{format:e,blend:t,writeMask:n}}CreateFragmentState(e,t="fragment",n,a){return n??(n=this.CreateTargetState()),n=Array.isArray(n)&&n||[n],{module:e,entryPoint:t,targets:n,constants:a}}CreateStencilFaceState(e,t,n,a){return{compare:e,failOp:t,depthFailOp:n,passOp:a}}CreateDepthStencilState(e="depth24plus",t=!0,n="less",a,p,x,S,O,B,I){return{format:e,depthWriteEnabled:t,depthCompare:n,stencilFront:a,stencilBack:p,stencilReadMask:x,stencilWriteMask:S,depthBias:O,depthBiasSlopeScale:B,depthBiasClamp:I}}CreateMultisampleState(e=4,t,n){return{count:e,mask:t,alphaToCoverageEnabled:n}}CreateStorageTextureBindingLayout(e=l(this,fr),t,n,a,p){return{binding:p,visibility:GPUShaderStage.FRAGMENT,storageTexture:{access:t,format:e,viewDimension:n}}}CreatePipeline(e={},t){let n=this.GetShaderModule(e),{vertex:a,fragment:p}=e;!n&&!a&&(n=this.CreateShaderModule()),n&&(a??(a=this.CreateVertexState(n)),p??(p=this.CreateFragmentState(n)));const x=e.label??this.CreatePipelineLabel("Render Pipeline"),S=e.layout??"auto";return this.SetPipeline(this.Device.createRenderPipeline({label:x,layout:S,vertex:a,fragment:p,...e})),t&&(l(this,ge)?l(this,ge).setPipeline(this.Pipeline):It(Y.RENDER_PASS_NOT_FOUND)),this.Pipeline}SavePipelineState(){super.SavePipelineState(),F(this,mt,l(this,at)),F(this,Xt,l(this,_t)),F(this,Ir,l(this,Ct)),F(this,pr,l(this,pt)),F(this,Pr,l(this,Nt)),F(this,Br,l(this,$t)),l(this,mt)&&F(this,mt,Object.values(l(this,mt)))}ResetPipelineState(){var e;super.ResetPipelineState(),this.SetIndexBuffer(void 0),F(this,Ir,[0,0,0,0]),F(this,pt,(e=l(this,pt))==null?void 0:e.destroy()),F(this,Nt,F(this,$t,!1))}RestorePipelineState(){super.RestorePipelineState(),F(this,_t,l(this,Xt)),F(this,Ct,l(this,Ir)),F(this,pt,l(this,pr)),F(this,Nt,l(this,Pr)),F(this,$t,l(this,Br)),this.SetIndexBuffer(...Array.isArray(l(this,mt))&&l(this,mt)||[void 0])}SetVertexBuffers(e,t,n){t=Array.isArray(t)&&t||[t],n=Array.isArray(n)&&n||[n],F(this,_t,Array.isArray(e)&&e.map((a,p)=>({buffer:a,offset:t[p],size:n[p]}))||[{buffer:e,offset:t[0],size:n[0]}])}AddVertexBuffers(e,t,n){t=Array.isArray(t)&&t||[t],n=Array.isArray(n)&&n||[n],l(this,_t).push(...Array.isArray(e)&&e.map((a,p)=>({buffer:a,offset:t[p],size:n[p]}))||[{buffer:e,offset:t[0],size:n[0]}])}SetIndexBuffer(e,t="uint32",n,a){F(this,at,e&&{buffer:e,format:t,offset:n,size:a})}SetCanvasSize(e,t,n=!0){!this.Device&&te(Y.DEVICE_NOT_FOUND),!l(this,ye)&&te(Y.CANVAS_NOT_FOUND);let a=this.DevicePixelRatio*e|0,p=this.DevicePixelRatio*t|0;const x=this.Device.limits.maxTextureDimension2D;a=Math.max(1,Math.min(a,x)),p=Math.max(1,Math.min(p,x)),(l(this,ye).width!==a||l(this,ye).height!==p)&&(l(this,ye).height=p,l(this,ye).width=a,W(this,vt,Vn).call(this),n&&(l(this,ye).style.width=`${e}px`,l(this,ye).style.height=`${t}px`))}Render(e,t=!0){l(this,$t)&&W(this,vt,ai).call(this),l(this,ge)||(l(this,pt)?(this.Descriptor.colorAttachments[0].view=l(this,pt).createView(),this.Descriptor.colorAttachments[0].resolveTarget=this.CurrentTextureView):l(this,Nt)&&(this.Descriptor.colorAttachments[0].view=this.CurrentTextureView),F(this,ge,this.GetCommandEncoder().beginRenderPass(this.Descriptor)),l(this,ge).setPipeline(this.Pipeline),F(this,wn,l(this,at)?l(this,ge).drawIndexed.bind(l(this,ge)):l(this,ge).draw.bind(l(this,ge))));for(let n=0,a=l(this,_t).length;n<a;++n){const{buffer:p,offset:x,size:S}=l(this,_t)[n];l(this,ge).setVertexBuffer(n,p,x,S)}l(this,at)&&l(this,ge).setIndexBuffer(l(this,at).buffer,l(this,at).format,l(this,at).offset,l(this,at).size);for(let n=0,a=0,p=this.BindGroups.length;n<p;++n){const{bindGroup:x,dynamicOffsets:S,active:O}=this.BindGroups[n];O&&l(this,ge).setBindGroup(a++,x,S)}l(this,ge).setBlendConstant(l(this,Ct)),l(this,wn).call(this,...Array.isArray(e)&&e||[e]),t&&this.Submit()}DestroyCurrentPass(){var e;(e=l(this,ge))==null||e.end(),F(this,ge,void 0)}Submit(){this.DestroyCurrentPass(),this.SubmitCommandBuffer(),this.SetCommandEncoder(void 0)}Destroy(){var e;this.DestroyCurrentPass(),(e=l(this,Ot))==null||e.unconfigure()}get Canvas(){return l(this,ye)}get Context(){return l(this,Ot)}get CurrentPass(){return l(this,ge)}get AspectRatio(){return!l(this,ye)&&te(Y.CANVAS_NOT_FOUND),l(this,ye).width/l(this,ye).height}get DepthTexture(){return l(this,ct)}get CurrentTexture(){return l(this,Ot).getCurrentTexture()}get CurrentTextureView(){return this.CurrentTexture.createView()}set MultisampleTexture(e){F(this,pt,e)}get MultisampleTexture(){return l(this,pt)}set BlendConstant(e){F(this,Ct,W(this,vt,zn).call(this,e))}get BlendConstant(){return l(this,Ct)}get ResolutionBuffer(){return l(this,wr)}get DevicePixelRatio(){return devicePixelRatio??1}set TextureView(e){this.Descriptor.colorAttachments[0].view=e,F(this,Nt,!e)}get BaseCanvasSize(){const{width:e,height:t}=l(this,ye),n=this.DevicePixelRatio;return[e/n,t/n]}get CanvasSize(){return[l(this,ye).width,l(this,ye).height]}Destroy(){var e,t,n,a,p,x,S;super.Destroy(),F(this,ge,void 0),l(this,wr).destroy(),F(this,Ct,[0,0,0,0]),F(this,kr,(e=l(this,kr))==null?void 0:e.Destroy()),F(this,ct,(t=l(this,ct))==null?void 0:t.destroy()),F(this,pr,(n=l(this,pr))==null?void 0:n.destroy()),F(this,Pr,F(this,Br,!1)),(a=l(this,Xt))==null||a.forEach(({buffer:O})=>O.destroy()),l(this,_t).forEach(({buffer:O})=>O.destroy()),(p=l(this,at))==null||p.buffer.destroy(),(x=l(this,mt))==null||x.splice(0),F(this,mt,void 0),(S=l(this,Xt))==null||S.splice(0),F(this,Xt,void 0),l(this,_t).splice(0),this.ResetPipelineState(),l(this,Ot).unconfigure()}}wn=new WeakMap,Nt=new WeakMap,$r=new WeakMap,$t=new WeakMap,ye=new WeakMap,Ot=new WeakMap,wr=new WeakMap,kr=new WeakMap,ct=new WeakMap,pt=new WeakMap,ge=new WeakMap,at=new WeakMap,fr=new WeakMap,Ct=new WeakMap,_t=new WeakMap,Xt=new WeakMap,Pr=new WeakMap,Br=new WeakMap,Ir=new WeakMap,pr=new WeakMap,mt=new WeakMap,vt=new WeakSet,Vn=function(){l(this,$r).set([l(this,ye).width,l(this,ye).height]),this.WriteBuffer(l(this,wr),l(this,$r))},zn=function(i){return i instanceof tn?i.rgba:i},Wn=function(i,e=0,t=0){return{format:i,shaderLocation:e,offset:t}},ai=function(){var i;const e=this.CurrentTexture,{width:t,height:n}=e;(!l(this,ct)||l(this,ct).width!==t||l(this,ct).height!==n)&&((i=l(this,ct))==null||i.destroy(),F(this,ct,l(this,kr).CreateTextureFromSource(e,{usage:GPUTextureUsage.RENDER_ATTACHMENT,label:"Depth Texture",format:"depth24plus",mipmaps:!1}))),this.Descriptor.depthStencilAttachment.view=l(this,ct).createView()};var kn;class Ea extends ii{constructor(e,t){super(e,t,"Compute"),P(this,kn,[1]),this.CreatePassDescriptor()}CreatePassDescriptor(e,t){return e??(e=this.CreatePipelineLabel("Compute Pass")),this.Descriptor={label:e,timestampWrites:t}}CreatePipeline(e){const t=e.label??this.CreatePipelineLabel("Compute Pipeline"),n=e.layout??"auto",a=this.GetShaderModule(e)??this.CreateShaderModule();return this.SetPipeline(this.Device.createComputePipeline({label:t,layout:n,compute:{module:a,...e}}))}Compute(e=!1){const t=this.GetCommandEncoder().beginComputePass(this.Descriptor);t.setPipeline(this.Pipeline);for(let n=0,a=0,p=this.BindGroups.length;n<p;++n){const{bindGroup:x,dynamicOffsets:S,active:O}=this.BindGroups[n];O&&t.setBindGroup(a++,x,S)}t.dispatchWorkgroups(...l(this,kn)),t.end(),e&&this.Submit()}Submit(){this.SubmitCommandBuffer(),this.SetCommandEncoder(void 0)}set Workgroups(e){F(this,kn,Array.isArray(e)&&e||[e])}Destroy(){super.Destroy(),this.Workgroups=1}}kn=new WeakMap;function Ma(i,e){return class extends i{constructor(...t){super(...t),e(this)}}}const Sa=Ma(Array,i=>i.fill(0));let Q=1e-6;function Aa(i){function e(r=0,d=0){const s=new i(2);return r!==void 0&&(s[0]=r,d!==void 0&&(s[1]=d)),s}const t=e;function n(r,d,s){const c=s??new i(2);return c[0]=r,c[1]=d,c}function a(r,d){const s=d??new i(2);return s[0]=Math.ceil(r[0]),s[1]=Math.ceil(r[1]),s}function p(r,d){const s=d??new i(2);return s[0]=Math.floor(r[0]),s[1]=Math.floor(r[1]),s}function x(r,d){const s=d??new i(2);return s[0]=Math.round(r[0]),s[1]=Math.round(r[1]),s}function S(r,d=0,s=1,c){const m=c??new i(2);return m[0]=Math.min(s,Math.max(d,r[0])),m[1]=Math.min(s,Math.max(d,r[1])),m}function O(r,d,s){const c=s??new i(2);return c[0]=r[0]+d[0],c[1]=r[1]+d[1],c}function B(r,d,s,c){const m=c??new i(2);return m[0]=r[0]+d[0]*s,m[1]=r[1]+d[1]*s,m}function I(r,d){const s=r[0],c=r[1],m=d[0],b=d[1],R=Math.sqrt(s*s+c*c),f=Math.sqrt(m*m+b*b),g=R*f,v=g&&We(r,d)/g;return Math.acos(v)}function V(r,d,s){const c=s??new i(2);return c[0]=r[0]-d[0],c[1]=r[1]-d[1],c}const z=V;function H(r,d){return Math.abs(r[0]-d[0])<Q&&Math.abs(r[1]-d[1])<Q}function re(r,d){return r[0]===d[0]&&r[1]===d[1]}function he(r,d,s,c){const m=c??new i(2);return m[0]=r[0]+s*(d[0]-r[0]),m[1]=r[1]+s*(d[1]-r[1]),m}function ke(r,d,s,c){const m=c??new i(2);return m[0]=r[0]+s[0]*(d[0]-r[0]),m[1]=r[1]+s[1]*(d[1]-r[1]),m}function fe(r,d,s){const c=s??new i(2);return c[0]=Math.max(r[0],d[0]),c[1]=Math.max(r[1],d[1]),c}function xe(r,d,s){const c=s??new i(2);return c[0]=Math.min(r[0],d[0]),c[1]=Math.min(r[1],d[1]),c}function le(r,d,s){const c=s??new i(2);return c[0]=r[0]*d,c[1]=r[1]*d,c}const De=le;function ve(r,d,s){const c=s??new i(2);return c[0]=r[0]/d,c[1]=r[1]/d,c}function Te(r,d){const s=d??new i(2);return s[0]=1/r[0],s[1]=1/r[1],s}const pe=Te;function ze(r,d,s){const c=s??new i(3),m=r[0]*d[1]-r[1]*d[0];return c[0]=0,c[1]=0,c[2]=m,c}function We(r,d){return r[0]*d[0]+r[1]*d[1]}function Ee(r){const d=r[0],s=r[1];return Math.sqrt(d*d+s*s)}const Ze=Ee;function K(r){const d=r[0],s=r[1];return d*d+s*s}const ne=K;function J(r,d){const s=r[0]-d[0],c=r[1]-d[1];return Math.sqrt(s*s+c*c)}const tt=J;function Fe(r,d){const s=r[0]-d[0],c=r[1]-d[1];return s*s+c*c}const rt=Fe;function Pe(r,d){const s=d??new i(2),c=r[0],m=r[1],b=Math.sqrt(c*c+m*m);return b>1e-5?(s[0]=c/b,s[1]=m/b):(s[0]=0,s[1]=0),s}function nt(r,d){const s=d??new i(2);return s[0]=-r[0],s[1]=-r[1],s}function ae(r,d){const s=d??new i(2);return s[0]=r[0],s[1]=r[1],s}const st=ae;function qe(r,d,s){const c=s??new i(2);return c[0]=r[0]*d[0],c[1]=r[1]*d[1],c}const it=qe;function Ve(r,d,s){const c=s??new i(2);return c[0]=r[0]/d[0],c[1]=r[1]/d[1],c}const je=Ve;function $e(r=1,d){const s=d??new i(2),c=Math.random()*2*Math.PI;return s[0]=Math.cos(c)*r,s[1]=Math.sin(c)*r,s}function u(r){const d=r??new i(2);return d[0]=0,d[1]=0,d}function w(r,d,s){const c=s??new i(2),m=r[0],b=r[1];return c[0]=m*d[0]+b*d[4]+d[12],c[1]=m*d[1]+b*d[5]+d[13],c}function o(r,d,s){const c=s??new i(2),m=r[0],b=r[1];return c[0]=d[0]*m+d[4]*b+d[8],c[1]=d[1]*m+d[5]*b+d[9],c}function h(r,d,s,c){const m=c??new i(2),b=r[0]-d[0],R=r[1]-d[1],f=Math.sin(s),g=Math.cos(s);return m[0]=b*g-R*f+d[0],m[1]=b*f+R*g+d[1],m}function y(r,d,s){const c=s??new i(2);return Pe(r,c),le(c,d,c)}function k(r,d,s){const c=s??new i(2);return Ee(r)>d?y(r,d,c):ae(r,c)}function C(r,d,s){const c=s??new i(2);return he(r,d,.5,c)}return{create:e,fromValues:t,set:n,ceil:a,floor:p,round:x,clamp:S,add:O,addScaled:B,angle:I,subtract:V,sub:z,equalsApproximately:H,equals:re,lerp:he,lerpV:ke,max:fe,min:xe,mulScalar:le,scale:De,divScalar:ve,inverse:Te,invert:pe,cross:ze,dot:We,length:Ee,len:Ze,lengthSq:K,lenSq:ne,distance:J,dist:tt,distanceSq:Fe,distSq:rt,normalize:Pe,negate:nt,copy:ae,clone:st,multiply:qe,mul:it,divide:Ve,div:je,random:$e,zero:u,transformMat4:w,transformMat3:o,rotate:h,setLength:y,truncate:k,midpoint:C}}const bs=new Map;function oi(i){let e=bs.get(i);return e||(e=Aa(i),bs.set(i,e)),e}function Na(i){function e(f,g,v){const T=new i(3);return f!==void 0&&(T[0]=f,g!==void 0&&(T[1]=g,v!==void 0&&(T[2]=v))),T}const t=e;function n(f,g,v,T){const N=T??new i(3);return N[0]=f,N[1]=g,N[2]=v,N}function a(f,g){const v=g??new i(3);return v[0]=Math.ceil(f[0]),v[1]=Math.ceil(f[1]),v[2]=Math.ceil(f[2]),v}function p(f,g){const v=g??new i(3);return v[0]=Math.floor(f[0]),v[1]=Math.floor(f[1]),v[2]=Math.floor(f[2]),v}function x(f,g){const v=g??new i(3);return v[0]=Math.round(f[0]),v[1]=Math.round(f[1]),v[2]=Math.round(f[2]),v}function S(f,g=0,v=1,T){const N=T??new i(3);return N[0]=Math.min(v,Math.max(g,f[0])),N[1]=Math.min(v,Math.max(g,f[1])),N[2]=Math.min(v,Math.max(g,f[2])),N}function O(f,g,v){const T=v??new i(3);return T[0]=f[0]+g[0],T[1]=f[1]+g[1],T[2]=f[2]+g[2],T}function B(f,g,v,T){const N=T??new i(3);return N[0]=f[0]+g[0]*v,N[1]=f[1]+g[1]*v,N[2]=f[2]+g[2]*v,N}function I(f,g){const v=f[0],T=f[1],N=f[2],U=g[0],D=g[1],L=g[2],X=Math.sqrt(v*v+T*T+N*N),G=Math.sqrt(U*U+D*D+L*L),q=X*G,Z=q&&We(f,g)/q;return Math.acos(Z)}function V(f,g,v){const T=v??new i(3);return T[0]=f[0]-g[0],T[1]=f[1]-g[1],T[2]=f[2]-g[2],T}const z=V;function H(f,g){return Math.abs(f[0]-g[0])<Q&&Math.abs(f[1]-g[1])<Q&&Math.abs(f[2]-g[2])<Q}function re(f,g){return f[0]===g[0]&&f[1]===g[1]&&f[2]===g[2]}function he(f,g,v,T){const N=T??new i(3);return N[0]=f[0]+v*(g[0]-f[0]),N[1]=f[1]+v*(g[1]-f[1]),N[2]=f[2]+v*(g[2]-f[2]),N}function ke(f,g,v,T){const N=T??new i(3);return N[0]=f[0]+v[0]*(g[0]-f[0]),N[1]=f[1]+v[1]*(g[1]-f[1]),N[2]=f[2]+v[2]*(g[2]-f[2]),N}function fe(f,g,v){const T=v??new i(3);return T[0]=Math.max(f[0],g[0]),T[1]=Math.max(f[1],g[1]),T[2]=Math.max(f[2],g[2]),T}function xe(f,g,v){const T=v??new i(3);return T[0]=Math.min(f[0],g[0]),T[1]=Math.min(f[1],g[1]),T[2]=Math.min(f[2],g[2]),T}function le(f,g,v){const T=v??new i(3);return T[0]=f[0]*g,T[1]=f[1]*g,T[2]=f[2]*g,T}const De=le;function ve(f,g,v){const T=v??new i(3);return T[0]=f[0]/g,T[1]=f[1]/g,T[2]=f[2]/g,T}function Te(f,g){const v=g??new i(3);return v[0]=1/f[0],v[1]=1/f[1],v[2]=1/f[2],v}const pe=Te;function ze(f,g,v){const T=v??new i(3),N=f[2]*g[0]-f[0]*g[2],U=f[0]*g[1]-f[1]*g[0];return T[0]=f[1]*g[2]-f[2]*g[1],T[1]=N,T[2]=U,T}function We(f,g){return f[0]*g[0]+f[1]*g[1]+f[2]*g[2]}function Ee(f){const g=f[0],v=f[1],T=f[2];return Math.sqrt(g*g+v*v+T*T)}const Ze=Ee;function K(f){const g=f[0],v=f[1],T=f[2];return g*g+v*v+T*T}const ne=K;function J(f,g){const v=f[0]-g[0],T=f[1]-g[1],N=f[2]-g[2];return Math.sqrt(v*v+T*T+N*N)}const tt=J;function Fe(f,g){const v=f[0]-g[0],T=f[1]-g[1],N=f[2]-g[2];return v*v+T*T+N*N}const rt=Fe;function Pe(f,g){const v=g??new i(3),T=f[0],N=f[1],U=f[2],D=Math.sqrt(T*T+N*N+U*U);return D>1e-5?(v[0]=T/D,v[1]=N/D,v[2]=U/D):(v[0]=0,v[1]=0,v[2]=0),v}function nt(f,g){const v=g??new i(3);return v[0]=-f[0],v[1]=-f[1],v[2]=-f[2],v}function ae(f,g){const v=g??new i(3);return v[0]=f[0],v[1]=f[1],v[2]=f[2],v}const st=ae;function qe(f,g,v){const T=v??new i(3);return T[0]=f[0]*g[0],T[1]=f[1]*g[1],T[2]=f[2]*g[2],T}const it=qe;function Ve(f,g,v){const T=v??new i(3);return T[0]=f[0]/g[0],T[1]=f[1]/g[1],T[2]=f[2]/g[2],T}const je=Ve;function $e(f=1,g){const v=g??new i(3),T=Math.random()*2*Math.PI,N=Math.random()*2-1,U=Math.sqrt(1-N*N)*f;return v[0]=Math.cos(T)*U,v[1]=Math.sin(T)*U,v[2]=N*f,v}function u(f){const g=f??new i(3);return g[0]=0,g[1]=0,g[2]=0,g}function w(f,g,v){const T=v??new i(3),N=f[0],U=f[1],D=f[2],L=g[3]*N+g[7]*U+g[11]*D+g[15]||1;return T[0]=(g[0]*N+g[4]*U+g[8]*D+g[12])/L,T[1]=(g[1]*N+g[5]*U+g[9]*D+g[13])/L,T[2]=(g[2]*N+g[6]*U+g[10]*D+g[14])/L,T}function o(f,g,v){const T=v??new i(3),N=f[0],U=f[1],D=f[2];return T[0]=N*g[0*4+0]+U*g[1*4+0]+D*g[2*4+0],T[1]=N*g[0*4+1]+U*g[1*4+1]+D*g[2*4+1],T[2]=N*g[0*4+2]+U*g[1*4+2]+D*g[2*4+2],T}function h(f,g,v){const T=v??new i(3),N=f[0],U=f[1],D=f[2];return T[0]=N*g[0]+U*g[4]+D*g[8],T[1]=N*g[1]+U*g[5]+D*g[9],T[2]=N*g[2]+U*g[6]+D*g[10],T}function y(f,g,v){const T=v??new i(3),N=g[0],U=g[1],D=g[2],L=g[3]*2,X=f[0],G=f[1],q=f[2],Z=U*q-D*G,ee=D*X-N*q,ue=N*G-U*X;return T[0]=X+Z*L+(U*ue-D*ee)*2,T[1]=G+ee*L+(D*Z-N*ue)*2,T[2]=q+ue*L+(N*ee-U*Z)*2,T}function k(f,g){const v=g??new i(3);return v[0]=f[12],v[1]=f[13],v[2]=f[14],v}function C(f,g,v){const T=v??new i(3),N=g*4;return T[0]=f[N+0],T[1]=f[N+1],T[2]=f[N+2],T}function r(f,g){const v=g??new i(3),T=f[0],N=f[1],U=f[2],D=f[4],L=f[5],X=f[6],G=f[8],q=f[9],Z=f[10];return v[0]=Math.sqrt(T*T+N*N+U*U),v[1]=Math.sqrt(D*D+L*L+X*X),v[2]=Math.sqrt(G*G+q*q+Z*Z),v}function d(f,g,v,T){const N=T??new i(3),U=[],D=[];return U[0]=f[0]-g[0],U[1]=f[1]-g[1],U[2]=f[2]-g[2],D[0]=U[0],D[1]=U[1]*Math.cos(v)-U[2]*Math.sin(v),D[2]=U[1]*Math.sin(v)+U[2]*Math.cos(v),N[0]=D[0]+g[0],N[1]=D[1]+g[1],N[2]=D[2]+g[2],N}function s(f,g,v,T){const N=T??new i(3),U=[],D=[];return U[0]=f[0]-g[0],U[1]=f[1]-g[1],U[2]=f[2]-g[2],D[0]=U[2]*Math.sin(v)+U[0]*Math.cos(v),D[1]=U[1],D[2]=U[2]*Math.cos(v)-U[0]*Math.sin(v),N[0]=D[0]+g[0],N[1]=D[1]+g[1],N[2]=D[2]+g[2],N}function c(f,g,v,T){const N=T??new i(3),U=[],D=[];return U[0]=f[0]-g[0],U[1]=f[1]-g[1],U[2]=f[2]-g[2],D[0]=U[0]*Math.cos(v)-U[1]*Math.sin(v),D[1]=U[0]*Math.sin(v)+U[1]*Math.cos(v),D[2]=U[2],N[0]=D[0]+g[0],N[1]=D[1]+g[1],N[2]=D[2]+g[2],N}function m(f,g,v){const T=v??new i(3);return Pe(f,T),le(T,g,T)}function b(f,g,v){const T=v??new i(3);return Ee(f)>g?m(f,g,T):ae(f,T)}function R(f,g,v){const T=v??new i(3);return he(f,g,.5,T)}return{create:e,fromValues:t,set:n,ceil:a,floor:p,round:x,clamp:S,add:O,addScaled:B,angle:I,subtract:V,sub:z,equalsApproximately:H,equals:re,lerp:he,lerpV:ke,max:fe,min:xe,mulScalar:le,scale:De,divScalar:ve,inverse:Te,invert:pe,cross:ze,dot:We,length:Ee,len:Ze,lengthSq:K,lenSq:ne,distance:J,dist:tt,distanceSq:Fe,distSq:rt,normalize:Pe,negate:nt,copy:ae,clone:st,multiply:qe,mul:it,divide:Ve,div:je,random:$e,zero:u,transformMat4:w,transformMat4Upper3x3:o,transformMat3:h,transformQuat:y,getTranslation:k,getAxis:C,getScaling:r,rotateX:d,rotateY:s,rotateZ:c,setLength:m,truncate:b,midpoint:R}}const Ts=new Map;function Un(i){let e=Ts.get(i);return e||(e=Na(i),Ts.set(i,e)),e}function Oa(i){const e=oi(i),t=Un(i);function n(u,w,o,h,y,k,C,r,d){const s=new i(12);return s[3]=0,s[7]=0,s[11]=0,u!==void 0&&(s[0]=u,w!==void 0&&(s[1]=w,o!==void 0&&(s[2]=o,h!==void 0&&(s[4]=h,y!==void 0&&(s[5]=y,k!==void 0&&(s[6]=k,C!==void 0&&(s[8]=C,r!==void 0&&(s[9]=r,d!==void 0&&(s[10]=d))))))))),s}function a(u,w,o,h,y,k,C,r,d,s){const c=s??new i(12);return c[0]=u,c[1]=w,c[2]=o,c[3]=0,c[4]=h,c[5]=y,c[6]=k,c[7]=0,c[8]=C,c[9]=r,c[10]=d,c[11]=0,c}function p(u,w){const o=w??new i(12);return o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=0,o[4]=u[4],o[5]=u[5],o[6]=u[6],o[7]=0,o[8]=u[8],o[9]=u[9],o[10]=u[10],o[11]=0,o}function x(u,w){const o=w??new i(12),h=u[0],y=u[1],k=u[2],C=u[3],r=h+h,d=y+y,s=k+k,c=h*r,m=y*r,b=y*d,R=k*r,f=k*d,g=k*s,v=C*r,T=C*d,N=C*s;return o[0]=1-b-g,o[1]=m+N,o[2]=R-T,o[3]=0,o[4]=m-N,o[5]=1-c-g,o[6]=f+v,o[7]=0,o[8]=R+T,o[9]=f-v,o[10]=1-c-b,o[11]=0,o}function S(u,w){const o=w??new i(12);return o[0]=-u[0],o[1]=-u[1],o[2]=-u[2],o[4]=-u[4],o[5]=-u[5],o[6]=-u[6],o[8]=-u[8],o[9]=-u[9],o[10]=-u[10],o}function O(u,w){const o=w??new i(12);return o[0]=u[0],o[1]=u[1],o[2]=u[2],o[4]=u[4],o[5]=u[5],o[6]=u[6],o[8]=u[8],o[9]=u[9],o[10]=u[10],o}const B=O;function I(u,w){return Math.abs(u[0]-w[0])<Q&&Math.abs(u[1]-w[1])<Q&&Math.abs(u[2]-w[2])<Q&&Math.abs(u[4]-w[4])<Q&&Math.abs(u[5]-w[5])<Q&&Math.abs(u[6]-w[6])<Q&&Math.abs(u[8]-w[8])<Q&&Math.abs(u[9]-w[9])<Q&&Math.abs(u[10]-w[10])<Q}function V(u,w){return u[0]===w[0]&&u[1]===w[1]&&u[2]===w[2]&&u[4]===w[4]&&u[5]===w[5]&&u[6]===w[6]&&u[8]===w[8]&&u[9]===w[9]&&u[10]===w[10]}function z(u){const w=u??new i(12);return w[0]=1,w[1]=0,w[2]=0,w[4]=0,w[5]=1,w[6]=0,w[8]=0,w[9]=0,w[10]=1,w}function H(u,w){const o=w??new i(12);if(o===u){let b;return b=u[1],u[1]=u[4],u[4]=b,b=u[2],u[2]=u[8],u[8]=b,b=u[6],u[6]=u[9],u[9]=b,o}const h=u[0*4+0],y=u[0*4+1],k=u[0*4+2],C=u[1*4+0],r=u[1*4+1],d=u[1*4+2],s=u[2*4+0],c=u[2*4+1],m=u[2*4+2];return o[0]=h,o[1]=C,o[2]=s,o[4]=y,o[5]=r,o[6]=c,o[8]=k,o[9]=d,o[10]=m,o}function re(u,w){const o=w??new i(12),h=u[0*4+0],y=u[0*4+1],k=u[0*4+2],C=u[1*4+0],r=u[1*4+1],d=u[1*4+2],s=u[2*4+0],c=u[2*4+1],m=u[2*4+2],b=m*r-d*c,R=-m*C+d*s,f=c*C-r*s,g=1/(h*b+y*R+k*f);return o[0]=b*g,o[1]=(-m*y+k*c)*g,o[2]=(d*y-k*r)*g,o[4]=R*g,o[5]=(m*h-k*s)*g,o[6]=(-d*h+k*C)*g,o[8]=f*g,o[9]=(-c*h+y*s)*g,o[10]=(r*h-y*C)*g,o}function he(u){const w=u[0],o=u[0*4+1],h=u[0*4+2],y=u[1*4+0],k=u[1*4+1],C=u[1*4+2],r=u[2*4+0],d=u[2*4+1],s=u[2*4+2];return w*(k*s-d*C)-y*(o*s-d*h)+r*(o*C-k*h)}const ke=re;function fe(u,w,o){const h=o??new i(12),y=u[0],k=u[1],C=u[2],r=u[4],d=u[5],s=u[6],c=u[8],m=u[9],b=u[10],R=w[0],f=w[1],g=w[2],v=w[4],T=w[5],N=w[6],U=w[8],D=w[9],L=w[10];return h[0]=y*R+r*f+c*g,h[1]=k*R+d*f+m*g,h[2]=C*R+s*f+b*g,h[4]=y*v+r*T+c*N,h[5]=k*v+d*T+m*N,h[6]=C*v+s*T+b*N,h[8]=y*U+r*D+c*L,h[9]=k*U+d*D+m*L,h[10]=C*U+s*D+b*L,h}const xe=fe;function le(u,w,o){const h=o??z();return u!==h&&(h[0]=u[0],h[1]=u[1],h[2]=u[2],h[4]=u[4],h[5]=u[5],h[6]=u[6]),h[8]=w[0],h[9]=w[1],h[10]=1,h}function De(u,w){const o=w??e.create();return o[0]=u[8],o[1]=u[9],o}function ve(u,w,o){const h=o??e.create(),y=w*4;return h[0]=u[y+0],h[1]=u[y+1],h}function Te(u,w,o,h){const y=h===u?u:O(u,h),k=o*4;return y[k+0]=w[0],y[k+1]=w[1],y}function pe(u,w){const o=w??e.create(),h=u[0],y=u[1],k=u[4],C=u[5];return o[0]=Math.sqrt(h*h+y*y),o[1]=Math.sqrt(k*k+C*C),o}function ze(u,w){const o=w??t.create(),h=u[0],y=u[1],k=u[2],C=u[4],r=u[5],d=u[6],s=u[8],c=u[9],m=u[10];return o[0]=Math.sqrt(h*h+y*y+k*k),o[1]=Math.sqrt(C*C+r*r+d*d),o[2]=Math.sqrt(s*s+c*c+m*m),o}function We(u,w){const o=w??new i(12);return o[0]=1,o[1]=0,o[2]=0,o[4]=0,o[5]=1,o[6]=0,o[8]=u[0],o[9]=u[1],o[10]=1,o}function Ee(u,w,o){const h=o??new i(12),y=w[0],k=w[1],C=u[0],r=u[1],d=u[2],s=u[1*4+0],c=u[1*4+1],m=u[1*4+2],b=u[2*4+0],R=u[2*4+1],f=u[2*4+2];return u!==h&&(h[0]=C,h[1]=r,h[2]=d,h[4]=s,h[5]=c,h[6]=m),h[8]=C*y+s*k+b,h[9]=r*y+c*k+R,h[10]=d*y+m*k+f,h}function Ze(u,w){const o=w??new i(12),h=Math.cos(u),y=Math.sin(u);return o[0]=h,o[1]=y,o[2]=0,o[4]=-y,o[5]=h,o[6]=0,o[8]=0,o[9]=0,o[10]=1,o}function K(u,w,o){const h=o??new i(12),y=u[0*4+0],k=u[0*4+1],C=u[0*4+2],r=u[1*4+0],d=u[1*4+1],s=u[1*4+2],c=Math.cos(w),m=Math.sin(w);return h[0]=c*y+m*r,h[1]=c*k+m*d,h[2]=c*C+m*s,h[4]=c*r-m*y,h[5]=c*d-m*k,h[6]=c*s-m*C,u!==h&&(h[8]=u[8],h[9]=u[9],h[10]=u[10]),h}function ne(u,w){const o=w??new i(12),h=Math.cos(u),y=Math.sin(u);return o[0]=1,o[1]=0,o[2]=0,o[4]=0,o[5]=h,o[6]=y,o[8]=0,o[9]=-y,o[10]=h,o}function J(u,w,o){const h=o??new i(12),y=u[4],k=u[5],C=u[6],r=u[8],d=u[9],s=u[10],c=Math.cos(w),m=Math.sin(w);return h[4]=c*y+m*r,h[5]=c*k+m*d,h[6]=c*C+m*s,h[8]=c*r-m*y,h[9]=c*d-m*k,h[10]=c*s-m*C,u!==h&&(h[0]=u[0],h[1]=u[1],h[2]=u[2]),h}function tt(u,w){const o=w??new i(12),h=Math.cos(u),y=Math.sin(u);return o[0]=h,o[1]=0,o[2]=-y,o[4]=0,o[5]=1,o[6]=0,o[8]=y,o[9]=0,o[10]=h,o}function Fe(u,w,o){const h=o??new i(12),y=u[0*4+0],k=u[0*4+1],C=u[0*4+2],r=u[2*4+0],d=u[2*4+1],s=u[2*4+2],c=Math.cos(w),m=Math.sin(w);return h[0]=c*y-m*r,h[1]=c*k-m*d,h[2]=c*C-m*s,h[8]=c*r+m*y,h[9]=c*d+m*k,h[10]=c*s+m*C,u!==h&&(h[4]=u[4],h[5]=u[5],h[6]=u[6]),h}const rt=Ze,Pe=K;function nt(u,w){const o=w??new i(12);return o[0]=u[0],o[1]=0,o[2]=0,o[4]=0,o[5]=u[1],o[6]=0,o[8]=0,o[9]=0,o[10]=1,o}function ae(u,w,o){const h=o??new i(12),y=w[0],k=w[1];return h[0]=y*u[0*4+0],h[1]=y*u[0*4+1],h[2]=y*u[0*4+2],h[4]=k*u[1*4+0],h[5]=k*u[1*4+1],h[6]=k*u[1*4+2],u!==h&&(h[8]=u[8],h[9]=u[9],h[10]=u[10]),h}function st(u,w){const o=w??new i(12);return o[0]=u[0],o[1]=0,o[2]=0,o[4]=0,o[5]=u[1],o[6]=0,o[8]=0,o[9]=0,o[10]=u[2],o}function qe(u,w,o){const h=o??new i(12),y=w[0],k=w[1],C=w[2];return h[0]=y*u[0*4+0],h[1]=y*u[0*4+1],h[2]=y*u[0*4+2],h[4]=k*u[1*4+0],h[5]=k*u[1*4+1],h[6]=k*u[1*4+2],h[8]=C*u[2*4+0],h[9]=C*u[2*4+1],h[10]=C*u[2*4+2],h}function it(u,w){const o=w??new i(12);return o[0]=u,o[1]=0,o[2]=0,o[4]=0,o[5]=u,o[6]=0,o[8]=0,o[9]=0,o[10]=1,o}function Ve(u,w,o){const h=o??new i(12);return h[0]=w*u[0*4+0],h[1]=w*u[0*4+1],h[2]=w*u[0*4+2],h[4]=w*u[1*4+0],h[5]=w*u[1*4+1],h[6]=w*u[1*4+2],u!==h&&(h[8]=u[8],h[9]=u[9],h[10]=u[10]),h}function je(u,w){const o=w??new i(12);return o[0]=u,o[1]=0,o[2]=0,o[4]=0,o[5]=u,o[6]=0,o[8]=0,o[9]=0,o[10]=u,o}function $e(u,w,o){const h=o??new i(12);return h[0]=w*u[0*4+0],h[1]=w*u[0*4+1],h[2]=w*u[0*4+2],h[4]=w*u[1*4+0],h[5]=w*u[1*4+1],h[6]=w*u[1*4+2],h[8]=w*u[2*4+0],h[9]=w*u[2*4+1],h[10]=w*u[2*4+2],h}return{clone:B,create:n,set:a,fromMat4:p,fromQuat:x,negate:S,copy:O,equalsApproximately:I,equals:V,identity:z,transpose:H,inverse:re,invert:ke,determinant:he,mul:xe,multiply:fe,setTranslation:le,getTranslation:De,getAxis:ve,setAxis:Te,getScaling:pe,get3DScaling:ze,translation:We,translate:Ee,rotation:Ze,rotate:K,rotationX:ne,rotateX:J,rotationY:tt,rotateY:Fe,rotationZ:rt,rotateZ:Pe,scaling:nt,scale:ae,uniformScaling:it,uniformScale:Ve,scaling3D:st,scale3D:qe,uniformScaling3D:je,uniformScale3D:$e}}const Es=new Map;function Ca(i){let e=Es.get(i);return e||(e=Oa(i),Es.set(i,e)),e}function Ra(i){const e=Un(i);function t(r,d,s,c,m,b,R,f,g,v,T,N,U,D,L,X){const G=new i(16);return r!==void 0&&(G[0]=r,d!==void 0&&(G[1]=d,s!==void 0&&(G[2]=s,c!==void 0&&(G[3]=c,m!==void 0&&(G[4]=m,b!==void 0&&(G[5]=b,R!==void 0&&(G[6]=R,f!==void 0&&(G[7]=f,g!==void 0&&(G[8]=g,v!==void 0&&(G[9]=v,T!==void 0&&(G[10]=T,N!==void 0&&(G[11]=N,U!==void 0&&(G[12]=U,D!==void 0&&(G[13]=D,L!==void 0&&(G[14]=L,X!==void 0&&(G[15]=X)))))))))))))))),G}function n(r,d,s,c,m,b,R,f,g,v,T,N,U,D,L,X,G){const q=G??new i(16);return q[0]=r,q[1]=d,q[2]=s,q[3]=c,q[4]=m,q[5]=b,q[6]=R,q[7]=f,q[8]=g,q[9]=v,q[10]=T,q[11]=N,q[12]=U,q[13]=D,q[14]=L,q[15]=X,q}function a(r,d){const s=d??new i(16);return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=0,s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=0,s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function p(r,d){const s=d??new i(16),c=r[0],m=r[1],b=r[2],R=r[3],f=c+c,g=m+m,v=b+b,T=c*f,N=m*f,U=m*g,D=b*f,L=b*g,X=b*v,G=R*f,q=R*g,Z=R*v;return s[0]=1-U-X,s[1]=N+Z,s[2]=D-q,s[3]=0,s[4]=N-Z,s[5]=1-T-X,s[6]=L+G,s[7]=0,s[8]=D+q,s[9]=L-G,s[10]=1-T-U,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function x(r,d){const s=d??new i(16);return s[0]=-r[0],s[1]=-r[1],s[2]=-r[2],s[3]=-r[3],s[4]=-r[4],s[5]=-r[5],s[6]=-r[6],s[7]=-r[7],s[8]=-r[8],s[9]=-r[9],s[10]=-r[10],s[11]=-r[11],s[12]=-r[12],s[13]=-r[13],s[14]=-r[14],s[15]=-r[15],s}function S(r,d){const s=d??new i(16);return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s}const O=S;function B(r,d){return Math.abs(r[0]-d[0])<Q&&Math.abs(r[1]-d[1])<Q&&Math.abs(r[2]-d[2])<Q&&Math.abs(r[3]-d[3])<Q&&Math.abs(r[4]-d[4])<Q&&Math.abs(r[5]-d[5])<Q&&Math.abs(r[6]-d[6])<Q&&Math.abs(r[7]-d[7])<Q&&Math.abs(r[8]-d[8])<Q&&Math.abs(r[9]-d[9])<Q&&Math.abs(r[10]-d[10])<Q&&Math.abs(r[11]-d[11])<Q&&Math.abs(r[12]-d[12])<Q&&Math.abs(r[13]-d[13])<Q&&Math.abs(r[14]-d[14])<Q&&Math.abs(r[15]-d[15])<Q}function I(r,d){return r[0]===d[0]&&r[1]===d[1]&&r[2]===d[2]&&r[3]===d[3]&&r[4]===d[4]&&r[5]===d[5]&&r[6]===d[6]&&r[7]===d[7]&&r[8]===d[8]&&r[9]===d[9]&&r[10]===d[10]&&r[11]===d[11]&&r[12]===d[12]&&r[13]===d[13]&&r[14]===d[14]&&r[15]===d[15]}function V(r){const d=r??new i(16);return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d}function z(r,d){const s=d??new i(16);if(s===r){let ee;return ee=r[1],r[1]=r[4],r[4]=ee,ee=r[2],r[2]=r[8],r[8]=ee,ee=r[3],r[3]=r[12],r[12]=ee,ee=r[6],r[6]=r[9],r[9]=ee,ee=r[7],r[7]=r[13],r[13]=ee,ee=r[11],r[11]=r[14],r[14]=ee,s}const c=r[0*4+0],m=r[0*4+1],b=r[0*4+2],R=r[0*4+3],f=r[1*4+0],g=r[1*4+1],v=r[1*4+2],T=r[1*4+3],N=r[2*4+0],U=r[2*4+1],D=r[2*4+2],L=r[2*4+3],X=r[3*4+0],G=r[3*4+1],q=r[3*4+2],Z=r[3*4+3];return s[0]=c,s[1]=f,s[2]=N,s[3]=X,s[4]=m,s[5]=g,s[6]=U,s[7]=G,s[8]=b,s[9]=v,s[10]=D,s[11]=q,s[12]=R,s[13]=T,s[14]=L,s[15]=Z,s}function H(r,d){const s=d??new i(16),c=r[0*4+0],m=r[0*4+1],b=r[0*4+2],R=r[0*4+3],f=r[1*4+0],g=r[1*4+1],v=r[1*4+2],T=r[1*4+3],N=r[2*4+0],U=r[2*4+1],D=r[2*4+2],L=r[2*4+3],X=r[3*4+0],G=r[3*4+1],q=r[3*4+2],Z=r[3*4+3],ee=D*Z,ue=q*L,_e=v*Z,me=q*T,Me=v*L,Ae=D*T,Ne=b*Z,Oe=q*R,Ce=b*L,Re=D*R,Be=b*T,Ie=v*R,Ge=N*G,Le=X*U,Xe=f*G,Ye=X*g,He=f*U,an=N*g,on=c*G,cn=X*m,un=c*U,hn=N*m,ln=c*g,dn=f*m,Jn=ee*g+me*U+Me*G-(ue*g+_e*U+Ae*G),Kn=ue*m+Ne*U+Re*G-(ee*m+Oe*U+Ce*G),es=_e*m+Oe*g+Be*G-(me*m+Ne*g+Ie*G),ts=Ae*m+Ce*g+Ie*U-(Me*m+Re*g+Be*U),Ue=1/(c*Jn+f*Kn+N*es+X*ts);return s[0]=Ue*Jn,s[1]=Ue*Kn,s[2]=Ue*es,s[3]=Ue*ts,s[4]=Ue*(ue*f+_e*N+Ae*X-(ee*f+me*N+Me*X)),s[5]=Ue*(ee*c+Oe*N+Ce*X-(ue*c+Ne*N+Re*X)),s[6]=Ue*(me*c+Ne*f+Ie*X-(_e*c+Oe*f+Be*X)),s[7]=Ue*(Me*c+Re*f+Be*N-(Ae*c+Ce*f+Ie*N)),s[8]=Ue*(Ge*T+Ye*L+He*Z-(Le*T+Xe*L+an*Z)),s[9]=Ue*(Le*R+on*L+hn*Z-(Ge*R+cn*L+un*Z)),s[10]=Ue*(Xe*R+cn*T+ln*Z-(Ye*R+on*T+dn*Z)),s[11]=Ue*(an*R+un*T+dn*L-(He*R+hn*T+ln*L)),s[12]=Ue*(Xe*D+an*q+Le*v-(He*q+Ge*v+Ye*D)),s[13]=Ue*(un*q+Ge*b+cn*D-(on*D+hn*q+Le*b)),s[14]=Ue*(on*v+dn*q+Ye*b-(ln*q+Xe*b+cn*v)),s[15]=Ue*(ln*D+He*b+hn*v-(un*v+dn*D+an*b)),s}function re(r){const d=r[0],s=r[0*4+1],c=r[0*4+2],m=r[0*4+3],b=r[1*4+0],R=r[1*4+1],f=r[1*4+2],g=r[1*4+3],v=r[2*4+0],T=r[2*4+1],N=r[2*4+2],U=r[2*4+3],D=r[3*4+0],L=r[3*4+1],X=r[3*4+2],G=r[3*4+3],q=N*G,Z=X*U,ee=f*G,ue=X*g,_e=f*U,me=N*g,Me=c*G,Ae=X*m,Ne=c*U,Oe=N*m,Ce=c*g,Re=f*m,Be=q*R+ue*T+_e*L-(Z*R+ee*T+me*L),Ie=Z*s+Me*T+Oe*L-(q*s+Ae*T+Ne*L),Ge=ee*s+Ae*R+Ce*L-(ue*s+Me*R+Re*L),Le=me*s+Ne*R+Re*T-(_e*s+Oe*R+Ce*T);return d*Be+b*Ie+v*Ge+D*Le}const he=H;function ke(r,d,s){const c=s??new i(16),m=r[0],b=r[1],R=r[2],f=r[3],g=r[4],v=r[5],T=r[6],N=r[7],U=r[8],D=r[9],L=r[10],X=r[11],G=r[12],q=r[13],Z=r[14],ee=r[15],ue=d[0],_e=d[1],me=d[2],Me=d[3],Ae=d[4],Ne=d[5],Oe=d[6],Ce=d[7],Re=d[8],Be=d[9],Ie=d[10],Ge=d[11],Le=d[12],Xe=d[13],Ye=d[14],He=d[15];return c[0]=m*ue+g*_e+U*me+G*Me,c[1]=b*ue+v*_e+D*me+q*Me,c[2]=R*ue+T*_e+L*me+Z*Me,c[3]=f*ue+N*_e+X*me+ee*Me,c[4]=m*Ae+g*Ne+U*Oe+G*Ce,c[5]=b*Ae+v*Ne+D*Oe+q*Ce,c[6]=R*Ae+T*Ne+L*Oe+Z*Ce,c[7]=f*Ae+N*Ne+X*Oe+ee*Ce,c[8]=m*Re+g*Be+U*Ie+G*Ge,c[9]=b*Re+v*Be+D*Ie+q*Ge,c[10]=R*Re+T*Be+L*Ie+Z*Ge,c[11]=f*Re+N*Be+X*Ie+ee*Ge,c[12]=m*Le+g*Xe+U*Ye+G*He,c[13]=b*Le+v*Xe+D*Ye+q*He,c[14]=R*Le+T*Xe+L*Ye+Z*He,c[15]=f*Le+N*Xe+X*Ye+ee*He,c}const fe=ke;function xe(r,d,s){const c=s??V();return r!==c&&(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5],c[6]=r[6],c[7]=r[7],c[8]=r[8],c[9]=r[9],c[10]=r[10],c[11]=r[11]),c[12]=d[0],c[13]=d[1],c[14]=d[2],c[15]=1,c}function le(r,d){const s=d??e.create();return s[0]=r[12],s[1]=r[13],s[2]=r[14],s}function De(r,d,s){const c=s??e.create(),m=d*4;return c[0]=r[m+0],c[1]=r[m+1],c[2]=r[m+2],c}function ve(r,d,s,c){const m=c===r?c:S(r,c),b=s*4;return m[b+0]=d[0],m[b+1]=d[1],m[b+2]=d[2],m}function Te(r,d){const s=d??e.create(),c=r[0],m=r[1],b=r[2],R=r[4],f=r[5],g=r[6],v=r[8],T=r[9],N=r[10];return s[0]=Math.sqrt(c*c+m*m+b*b),s[1]=Math.sqrt(R*R+f*f+g*g),s[2]=Math.sqrt(v*v+T*T+N*N),s}function pe(r,d,s,c,m){const b=m??new i(16),R=Math.tan(Math.PI*.5-.5*r);if(b[0]=R/d,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=R,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,Number.isFinite(c)){const f=1/(s-c);b[10]=c*f,b[14]=c*s*f}else b[10]=-1,b[14]=-s;return b}function ze(r,d,s,c=1/0,m){const b=m??new i(16),R=1/Math.tan(r*.5);if(b[0]=R/d,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=R,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,c===1/0)b[10]=0,b[14]=s;else{const f=1/(c-s);b[10]=s*f,b[14]=c*s*f}return b}function We(r,d,s,c,m,b,R){const f=R??new i(16);return f[0]=2/(d-r),f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=2/(c-s),f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1/(m-b),f[11]=0,f[12]=(d+r)/(r-d),f[13]=(c+s)/(s-c),f[14]=m/(m-b),f[15]=1,f}function Ee(r,d,s,c,m,b,R){const f=R??new i(16),g=d-r,v=c-s,T=m-b;return f[0]=2*m/g,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=2*m/v,f[6]=0,f[7]=0,f[8]=(r+d)/g,f[9]=(c+s)/v,f[10]=b/T,f[11]=-1,f[12]=0,f[13]=0,f[14]=m*b/T,f[15]=0,f}function Ze(r,d,s,c,m,b=1/0,R){const f=R??new i(16),g=d-r,v=c-s;if(f[0]=2*m/g,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=2*m/v,f[6]=0,f[7]=0,f[8]=(r+d)/g,f[9]=(c+s)/v,f[11]=-1,f[12]=0,f[13]=0,f[15]=0,b===1/0)f[10]=0,f[14]=m;else{const T=1/(b-m);f[10]=m*T,f[14]=b*m*T}return f}const K=e.create(),ne=e.create(),J=e.create();function tt(r,d,s,c){const m=c??new i(16);return e.normalize(e.subtract(d,r,J),J),e.normalize(e.cross(s,J,K),K),e.normalize(e.cross(J,K,ne),ne),m[0]=K[0],m[1]=K[1],m[2]=K[2],m[3]=0,m[4]=ne[0],m[5]=ne[1],m[6]=ne[2],m[7]=0,m[8]=J[0],m[9]=J[1],m[10]=J[2],m[11]=0,m[12]=r[0],m[13]=r[1],m[14]=r[2],m[15]=1,m}function Fe(r,d,s,c){const m=c??new i(16);return e.normalize(e.subtract(r,d,J),J),e.normalize(e.cross(s,J,K),K),e.normalize(e.cross(J,K,ne),ne),m[0]=K[0],m[1]=K[1],m[2]=K[2],m[3]=0,m[4]=ne[0],m[5]=ne[1],m[6]=ne[2],m[7]=0,m[8]=J[0],m[9]=J[1],m[10]=J[2],m[11]=0,m[12]=r[0],m[13]=r[1],m[14]=r[2],m[15]=1,m}function rt(r,d,s,c){const m=c??new i(16);return e.normalize(e.subtract(r,d,J),J),e.normalize(e.cross(s,J,K),K),e.normalize(e.cross(J,K,ne),ne),m[0]=K[0],m[1]=ne[0],m[2]=J[0],m[3]=0,m[4]=K[1],m[5]=ne[1],m[6]=J[1],m[7]=0,m[8]=K[2],m[9]=ne[2],m[10]=J[2],m[11]=0,m[12]=-(K[0]*r[0]+K[1]*r[1]+K[2]*r[2]),m[13]=-(ne[0]*r[0]+ne[1]*r[1]+ne[2]*r[2]),m[14]=-(J[0]*r[0]+J[1]*r[1]+J[2]*r[2]),m[15]=1,m}function Pe(r,d){const s=d??new i(16);return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=r[0],s[13]=r[1],s[14]=r[2],s[15]=1,s}function nt(r,d,s){const c=s??new i(16),m=d[0],b=d[1],R=d[2],f=r[0],g=r[1],v=r[2],T=r[3],N=r[1*4+0],U=r[1*4+1],D=r[1*4+2],L=r[1*4+3],X=r[2*4+0],G=r[2*4+1],q=r[2*4+2],Z=r[2*4+3],ee=r[3*4+0],ue=r[3*4+1],_e=r[3*4+2],me=r[3*4+3];return r!==c&&(c[0]=f,c[1]=g,c[2]=v,c[3]=T,c[4]=N,c[5]=U,c[6]=D,c[7]=L,c[8]=X,c[9]=G,c[10]=q,c[11]=Z),c[12]=f*m+N*b+X*R+ee,c[13]=g*m+U*b+G*R+ue,c[14]=v*m+D*b+q*R+_e,c[15]=T*m+L*b+Z*R+me,c}function ae(r,d){const s=d??new i(16),c=Math.cos(r),m=Math.sin(r);return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=c,s[6]=m,s[7]=0,s[8]=0,s[9]=-m,s[10]=c,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function st(r,d,s){const c=s??new i(16),m=r[4],b=r[5],R=r[6],f=r[7],g=r[8],v=r[9],T=r[10],N=r[11],U=Math.cos(d),D=Math.sin(d);return c[4]=U*m+D*g,c[5]=U*b+D*v,c[6]=U*R+D*T,c[7]=U*f+D*N,c[8]=U*g-D*m,c[9]=U*v-D*b,c[10]=U*T-D*R,c[11]=U*N-D*f,r!==c&&(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[12]=r[12],c[13]=r[13],c[14]=r[14],c[15]=r[15]),c}function qe(r,d){const s=d??new i(16),c=Math.cos(r),m=Math.sin(r);return s[0]=c,s[1]=0,s[2]=-m,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=m,s[9]=0,s[10]=c,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function it(r,d,s){const c=s??new i(16),m=r[0*4+0],b=r[0*4+1],R=r[0*4+2],f=r[0*4+3],g=r[2*4+0],v=r[2*4+1],T=r[2*4+2],N=r[2*4+3],U=Math.cos(d),D=Math.sin(d);return c[0]=U*m-D*g,c[1]=U*b-D*v,c[2]=U*R-D*T,c[3]=U*f-D*N,c[8]=U*g+D*m,c[9]=U*v+D*b,c[10]=U*T+D*R,c[11]=U*N+D*f,r!==c&&(c[4]=r[4],c[5]=r[5],c[6]=r[6],c[7]=r[7],c[12]=r[12],c[13]=r[13],c[14]=r[14],c[15]=r[15]),c}function Ve(r,d){const s=d??new i(16),c=Math.cos(r),m=Math.sin(r);return s[0]=c,s[1]=m,s[2]=0,s[3]=0,s[4]=-m,s[5]=c,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function je(r,d,s){const c=s??new i(16),m=r[0*4+0],b=r[0*4+1],R=r[0*4+2],f=r[0*4+3],g=r[1*4+0],v=r[1*4+1],T=r[1*4+2],N=r[1*4+3],U=Math.cos(d),D=Math.sin(d);return c[0]=U*m+D*g,c[1]=U*b+D*v,c[2]=U*R+D*T,c[3]=U*f+D*N,c[4]=U*g-D*m,c[5]=U*v-D*b,c[6]=U*T-D*R,c[7]=U*N-D*f,r!==c&&(c[8]=r[8],c[9]=r[9],c[10]=r[10],c[11]=r[11],c[12]=r[12],c[13]=r[13],c[14]=r[14],c[15]=r[15]),c}function $e(r,d,s){const c=s??new i(16);let m=r[0],b=r[1],R=r[2];const f=Math.sqrt(m*m+b*b+R*R);m/=f,b/=f,R/=f;const g=m*m,v=b*b,T=R*R,N=Math.cos(d),U=Math.sin(d),D=1-N;return c[0]=g+(1-g)*N,c[1]=m*b*D+R*U,c[2]=m*R*D-b*U,c[3]=0,c[4]=m*b*D-R*U,c[5]=v+(1-v)*N,c[6]=b*R*D+m*U,c[7]=0,c[8]=m*R*D+b*U,c[9]=b*R*D-m*U,c[10]=T+(1-T)*N,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}const u=$e;function w(r,d,s,c){const m=c??new i(16);let b=d[0],R=d[1],f=d[2];const g=Math.sqrt(b*b+R*R+f*f);b/=g,R/=g,f/=g;const v=b*b,T=R*R,N=f*f,U=Math.cos(s),D=Math.sin(s),L=1-U,X=v+(1-v)*U,G=b*R*L+f*D,q=b*f*L-R*D,Z=b*R*L-f*D,ee=T+(1-T)*U,ue=R*f*L+b*D,_e=b*f*L+R*D,me=R*f*L-b*D,Me=N+(1-N)*U,Ae=r[0],Ne=r[1],Oe=r[2],Ce=r[3],Re=r[4],Be=r[5],Ie=r[6],Ge=r[7],Le=r[8],Xe=r[9],Ye=r[10],He=r[11];return m[0]=X*Ae+G*Re+q*Le,m[1]=X*Ne+G*Be+q*Xe,m[2]=X*Oe+G*Ie+q*Ye,m[3]=X*Ce+G*Ge+q*He,m[4]=Z*Ae+ee*Re+ue*Le,m[5]=Z*Ne+ee*Be+ue*Xe,m[6]=Z*Oe+ee*Ie+ue*Ye,m[7]=Z*Ce+ee*Ge+ue*He,m[8]=_e*Ae+me*Re+Me*Le,m[9]=_e*Ne+me*Be+Me*Xe,m[10]=_e*Oe+me*Ie+Me*Ye,m[11]=_e*Ce+me*Ge+Me*He,r!==m&&(m[12]=r[12],m[13]=r[13],m[14]=r[14],m[15]=r[15]),m}const o=w;function h(r,d){const s=d??new i(16);return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function y(r,d,s){const c=s??new i(16),m=d[0],b=d[1],R=d[2];return c[0]=m*r[0*4+0],c[1]=m*r[0*4+1],c[2]=m*r[0*4+2],c[3]=m*r[0*4+3],c[4]=b*r[1*4+0],c[5]=b*r[1*4+1],c[6]=b*r[1*4+2],c[7]=b*r[1*4+3],c[8]=R*r[2*4+0],c[9]=R*r[2*4+1],c[10]=R*r[2*4+2],c[11]=R*r[2*4+3],r!==c&&(c[12]=r[12],c[13]=r[13],c[14]=r[14],c[15]=r[15]),c}function k(r,d){const s=d??new i(16);return s[0]=r,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function C(r,d,s){const c=s??new i(16);return c[0]=d*r[0*4+0],c[1]=d*r[0*4+1],c[2]=d*r[0*4+2],c[3]=d*r[0*4+3],c[4]=d*r[1*4+0],c[5]=d*r[1*4+1],c[6]=d*r[1*4+2],c[7]=d*r[1*4+3],c[8]=d*r[2*4+0],c[9]=d*r[2*4+1],c[10]=d*r[2*4+2],c[11]=d*r[2*4+3],r!==c&&(c[12]=r[12],c[13]=r[13],c[14]=r[14],c[15]=r[15]),c}return{create:t,set:n,fromMat3:a,fromQuat:p,negate:x,copy:S,clone:O,equalsApproximately:B,equals:I,identity:V,transpose:z,inverse:H,determinant:re,invert:he,multiply:ke,mul:fe,setTranslation:xe,getTranslation:le,getAxis:De,setAxis:ve,getScaling:Te,perspective:pe,perspectiveReverseZ:ze,ortho:We,frustum:Ee,frustumReverseZ:Ze,aim:tt,cameraAim:Fe,lookAt:rt,translation:Pe,translate:nt,rotationX:ae,rotateX:st,rotationY:qe,rotateY:it,rotationZ:Ve,rotateZ:je,axisRotation:$e,rotation:u,axisRotate:w,rotate:o,scaling:h,scale:y,uniformScaling:k,uniformScale:C}}const Ms=new Map;function Ua(i){let e=Ms.get(i);return e||(e=Ra(i),Ms.set(i,e)),e}function Da(i){const e=Un(i);function t(u,w,o,h){const y=new i(4);return u!==void 0&&(y[0]=u,w!==void 0&&(y[1]=w,o!==void 0&&(y[2]=o,h!==void 0&&(y[3]=h)))),y}const n=t;function a(u,w,o,h,y){const k=y??new i(4);return k[0]=u,k[1]=w,k[2]=o,k[3]=h,k}function p(u,w,o){const h=o??new i(4),y=w*.5,k=Math.sin(y);return h[0]=k*u[0],h[1]=k*u[1],h[2]=k*u[2],h[3]=Math.cos(y),h}function x(u,w){const o=w??e.create(3),h=Math.acos(u[3])*2,y=Math.sin(h*.5);return y>Q?(o[0]=u[0]/y,o[1]=u[1]/y,o[2]=u[2]/y):(o[0]=1,o[1]=0,o[2]=0),{angle:h,axis:o}}function S(u,w){const o=Ee(u,w);return Math.acos(2*o*o-1)}function O(u,w,o){const h=o??new i(4),y=u[0],k=u[1],C=u[2],r=u[3],d=w[0],s=w[1],c=w[2],m=w[3];return h[0]=y*m+r*d+k*c-C*s,h[1]=k*m+r*s+C*d-y*c,h[2]=C*m+r*c+y*s-k*d,h[3]=r*m-y*d-k*s-C*c,h}const B=O;function I(u,w,o){const h=o??new i(4),y=w*.5,k=u[0],C=u[1],r=u[2],d=u[3],s=Math.sin(y),c=Math.cos(y);return h[0]=k*c+d*s,h[1]=C*c+r*s,h[2]=r*c-C*s,h[3]=d*c-k*s,h}function V(u,w,o){const h=o??new i(4),y=w*.5,k=u[0],C=u[1],r=u[2],d=u[3],s=Math.sin(y),c=Math.cos(y);return h[0]=k*c-r*s,h[1]=C*c+d*s,h[2]=r*c+k*s,h[3]=d*c-C*s,h}function z(u,w,o){const h=o??new i(4),y=w*.5,k=u[0],C=u[1],r=u[2],d=u[3],s=Math.sin(y),c=Math.cos(y);return h[0]=k*c+C*s,h[1]=C*c-k*s,h[2]=r*c+d*s,h[3]=d*c-r*s,h}function H(u,w,o,h){const y=h??new i(4),k=u[0],C=u[1],r=u[2],d=u[3];let s=w[0],c=w[1],m=w[2],b=w[3],R=k*s+C*c+r*m+d*b;R<0&&(R=-R,s=-s,c=-c,m=-m,b=-b);let f,g;if(1-R>Q){const v=Math.acos(R),T=Math.sin(v);f=Math.sin((1-o)*v)/T,g=Math.sin(o*v)/T}else f=1-o,g=o;return y[0]=f*k+g*s,y[1]=f*C+g*c,y[2]=f*r+g*m,y[3]=f*d+g*b,y}function re(u,w){const o=w??new i(4),h=u[0],y=u[1],k=u[2],C=u[3],r=h*h+y*y+k*k+C*C,d=r?1/r:0;return o[0]=-h*d,o[1]=-y*d,o[2]=-k*d,o[3]=C*d,o}function he(u,w){const o=w??new i(4);return o[0]=-u[0],o[1]=-u[1],o[2]=-u[2],o[3]=u[3],o}function ke(u,w){const o=w??new i(4),h=u[0]+u[5]+u[10];if(h>0){const y=Math.sqrt(h+1);o[3]=.5*y;const k=.5/y;o[0]=(u[6]-u[9])*k,o[1]=(u[8]-u[2])*k,o[2]=(u[1]-u[4])*k}else{let y=0;u[5]>u[0]&&(y=1),u[10]>u[y*4+y]&&(y=2);const k=(y+1)%3,C=(y+2)%3,r=Math.sqrt(u[y*4+y]-u[k*4+k]-u[C*4+C]+1);o[y]=.5*r;const d=.5/r;o[3]=(u[k*4+C]-u[C*4+k])*d,o[k]=(u[k*4+y]+u[y*4+k])*d,o[C]=(u[C*4+y]+u[y*4+C])*d}return o}function fe(u,w,o,h,y){const k=y??new i(4),C=u*.5,r=w*.5,d=o*.5,s=Math.sin(C),c=Math.cos(C),m=Math.sin(r),b=Math.cos(r),R=Math.sin(d),f=Math.cos(d);switch(h){case"xyz":k[0]=s*b*f+c*m*R,k[1]=c*m*f-s*b*R,k[2]=c*b*R+s*m*f,k[3]=c*b*f-s*m*R;break;case"xzy":k[0]=s*b*f-c*m*R,k[1]=c*m*f-s*b*R,k[2]=c*b*R+s*m*f,k[3]=c*b*f+s*m*R;break;case"yxz":k[0]=s*b*f+c*m*R,k[1]=c*m*f-s*b*R,k[2]=c*b*R-s*m*f,k[3]=c*b*f+s*m*R;break;case"yzx":k[0]=s*b*f+c*m*R,k[1]=c*m*f+s*b*R,k[2]=c*b*R-s*m*f,k[3]=c*b*f-s*m*R;break;case"zxy":k[0]=s*b*f-c*m*R,k[1]=c*m*f+s*b*R,k[2]=c*b*R+s*m*f,k[3]=c*b*f-s*m*R;break;case"zyx":k[0]=s*b*f-c*m*R,k[1]=c*m*f+s*b*R,k[2]=c*b*R-s*m*f,k[3]=c*b*f+s*m*R;break;default:throw new Error(`Unknown rotation order: ${h}`)}return k}function xe(u,w){const o=w??new i(4);return o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o}const le=xe;function De(u,w,o){const h=o??new i(4);return h[0]=u[0]+w[0],h[1]=u[1]+w[1],h[2]=u[2]+w[2],h[3]=u[3]+w[3],h}function ve(u,w,o){const h=o??new i(4);return h[0]=u[0]-w[0],h[1]=u[1]-w[1],h[2]=u[2]-w[2],h[3]=u[3]-w[3],h}const Te=ve;function pe(u,w,o){const h=o??new i(4);return h[0]=u[0]*w,h[1]=u[1]*w,h[2]=u[2]*w,h[3]=u[3]*w,h}const ze=pe;function We(u,w,o){const h=o??new i(4);return h[0]=u[0]/w,h[1]=u[1]/w,h[2]=u[2]/w,h[3]=u[3]/w,h}function Ee(u,w){return u[0]*w[0]+u[1]*w[1]+u[2]*w[2]+u[3]*w[3]}function Ze(u,w,o,h){const y=h??new i(4);return y[0]=u[0]+o*(w[0]-u[0]),y[1]=u[1]+o*(w[1]-u[1]),y[2]=u[2]+o*(w[2]-u[2]),y[3]=u[3]+o*(w[3]-u[3]),y}function K(u){const w=u[0],o=u[1],h=u[2],y=u[3];return Math.sqrt(w*w+o*o+h*h+y*y)}const ne=K;function J(u){const w=u[0],o=u[1],h=u[2],y=u[3];return w*w+o*o+h*h+y*y}const tt=J;function Fe(u,w){const o=w??new i(4),h=u[0],y=u[1],k=u[2],C=u[3],r=Math.sqrt(h*h+y*y+k*k+C*C);return r>1e-5?(o[0]=h/r,o[1]=y/r,o[2]=k/r,o[3]=C/r):(o[0]=0,o[1]=0,o[2]=0,o[3]=1),o}function rt(u,w){return Math.abs(u[0]-w[0])<Q&&Math.abs(u[1]-w[1])<Q&&Math.abs(u[2]-w[2])<Q&&Math.abs(u[3]-w[3])<Q}function Pe(u,w){return u[0]===w[0]&&u[1]===w[1]&&u[2]===w[2]&&u[3]===w[3]}function nt(u){const w=u??new i(4);return w[0]=0,w[1]=0,w[2]=0,w[3]=1,w}const ae=e.create(),st=e.create(),qe=e.create();function it(u,w,o){const h=o??new i(4),y=e.dot(u,w);return y<-.999999?(e.cross(st,u,ae),e.len(ae)<1e-6&&e.cross(qe,u,ae),e.normalize(ae,ae),p(ae,Math.PI,h),h):y>.999999?(h[0]=0,h[1]=0,h[2]=0,h[3]=1,h):(e.cross(u,w,ae),h[0]=ae[0],h[1]=ae[1],h[2]=ae[2],h[3]=1+y,Fe(h,h))}const Ve=new i(4),je=new i(4);function $e(u,w,o,h,y,k){const C=k??new i(4);return H(u,h,y,Ve),H(w,o,y,je),H(Ve,je,2*y*(1-y),C),C}return{create:t,fromValues:n,set:a,fromAxisAngle:p,toAxisAngle:x,angle:S,multiply:O,mul:B,rotateX:I,rotateY:V,rotateZ:z,slerp:H,inverse:re,conjugate:he,fromMat:ke,fromEuler:fe,copy:xe,clone:le,add:De,subtract:ve,sub:Te,mulScalar:pe,scale:ze,divScalar:We,dot:Ee,lerp:Ze,length:K,len:ne,lengthSq:J,lenSq:tt,normalize:Fe,equalsApproximately:rt,equals:Pe,identity:nt,rotationTo:it,sqlerp:$e}}const Ss=new Map;function Fa(i){let e=Ss.get(i);return e||(e=Da(i),Ss.set(i,e)),e}function Pa(i){function e(o,h,y,k){const C=new i(4);return o!==void 0&&(C[0]=o,h!==void 0&&(C[1]=h,y!==void 0&&(C[2]=y,k!==void 0&&(C[3]=k)))),C}const t=e;function n(o,h,y,k,C){const r=C??new i(4);return r[0]=o,r[1]=h,r[2]=y,r[3]=k,r}function a(o,h){const y=h??new i(4);return y[0]=Math.ceil(o[0]),y[1]=Math.ceil(o[1]),y[2]=Math.ceil(o[2]),y[3]=Math.ceil(o[3]),y}function p(o,h){const y=h??new i(4);return y[0]=Math.floor(o[0]),y[1]=Math.floor(o[1]),y[2]=Math.floor(o[2]),y[3]=Math.floor(o[3]),y}function x(o,h){const y=h??new i(4);return y[0]=Math.round(o[0]),y[1]=Math.round(o[1]),y[2]=Math.round(o[2]),y[3]=Math.round(o[3]),y}function S(o,h=0,y=1,k){const C=k??new i(4);return C[0]=Math.min(y,Math.max(h,o[0])),C[1]=Math.min(y,Math.max(h,o[1])),C[2]=Math.min(y,Math.max(h,o[2])),C[3]=Math.min(y,Math.max(h,o[3])),C}function O(o,h,y){const k=y??new i(4);return k[0]=o[0]+h[0],k[1]=o[1]+h[1],k[2]=o[2]+h[2],k[3]=o[3]+h[3],k}function B(o,h,y,k){const C=k??new i(4);return C[0]=o[0]+h[0]*y,C[1]=o[1]+h[1]*y,C[2]=o[2]+h[2]*y,C[3]=o[3]+h[3]*y,C}function I(o,h,y){const k=y??new i(4);return k[0]=o[0]-h[0],k[1]=o[1]-h[1],k[2]=o[2]-h[2],k[3]=o[3]-h[3],k}const V=I;function z(o,h){return Math.abs(o[0]-h[0])<Q&&Math.abs(o[1]-h[1])<Q&&Math.abs(o[2]-h[2])<Q&&Math.abs(o[3]-h[3])<Q}function H(o,h){return o[0]===h[0]&&o[1]===h[1]&&o[2]===h[2]&&o[3]===h[3]}function re(o,h,y,k){const C=k??new i(4);return C[0]=o[0]+y*(h[0]-o[0]),C[1]=o[1]+y*(h[1]-o[1]),C[2]=o[2]+y*(h[2]-o[2]),C[3]=o[3]+y*(h[3]-o[3]),C}function he(o,h,y,k){const C=k??new i(4);return C[0]=o[0]+y[0]*(h[0]-o[0]),C[1]=o[1]+y[1]*(h[1]-o[1]),C[2]=o[2]+y[2]*(h[2]-o[2]),C[3]=o[3]+y[3]*(h[3]-o[3]),C}function ke(o,h,y){const k=y??new i(4);return k[0]=Math.max(o[0],h[0]),k[1]=Math.max(o[1],h[1]),k[2]=Math.max(o[2],h[2]),k[3]=Math.max(o[3],h[3]),k}function fe(o,h,y){const k=y??new i(4);return k[0]=Math.min(o[0],h[0]),k[1]=Math.min(o[1],h[1]),k[2]=Math.min(o[2],h[2]),k[3]=Math.min(o[3],h[3]),k}function xe(o,h,y){const k=y??new i(4);return k[0]=o[0]*h,k[1]=o[1]*h,k[2]=o[2]*h,k[3]=o[3]*h,k}const le=xe;function De(o,h,y){const k=y??new i(4);return k[0]=o[0]/h,k[1]=o[1]/h,k[2]=o[2]/h,k[3]=o[3]/h,k}function ve(o,h){const y=h??new i(4);return y[0]=1/o[0],y[1]=1/o[1],y[2]=1/o[2],y[3]=1/o[3],y}const Te=ve;function pe(o,h){return o[0]*h[0]+o[1]*h[1]+o[2]*h[2]+o[3]*h[3]}function ze(o){const h=o[0],y=o[1],k=o[2],C=o[3];return Math.sqrt(h*h+y*y+k*k+C*C)}const We=ze;function Ee(o){const h=o[0],y=o[1],k=o[2],C=o[3];return h*h+y*y+k*k+C*C}const Ze=Ee;function K(o,h){const y=o[0]-h[0],k=o[1]-h[1],C=o[2]-h[2],r=o[3]-h[3];return Math.sqrt(y*y+k*k+C*C+r*r)}const ne=K;function J(o,h){const y=o[0]-h[0],k=o[1]-h[1],C=o[2]-h[2],r=o[3]-h[3];return y*y+k*k+C*C+r*r}const tt=J;function Fe(o,h){const y=h??new i(4),k=o[0],C=o[1],r=o[2],d=o[3],s=Math.sqrt(k*k+C*C+r*r+d*d);return s>1e-5?(y[0]=k/s,y[1]=C/s,y[2]=r/s,y[3]=d/s):(y[0]=0,y[1]=0,y[2]=0,y[3]=0),y}function rt(o,h){const y=h??new i(4);return y[0]=-o[0],y[1]=-o[1],y[2]=-o[2],y[3]=-o[3],y}function Pe(o,h){const y=h??new i(4);return y[0]=o[0],y[1]=o[1],y[2]=o[2],y[3]=o[3],y}const nt=Pe;function ae(o,h,y){const k=y??new i(4);return k[0]=o[0]*h[0],k[1]=o[1]*h[1],k[2]=o[2]*h[2],k[3]=o[3]*h[3],k}const st=ae;function qe(o,h,y){const k=y??new i(4);return k[0]=o[0]/h[0],k[1]=o[1]/h[1],k[2]=o[2]/h[2],k[3]=o[3]/h[3],k}const it=qe;function Ve(o){const h=o??new i(4);return h[0]=0,h[1]=0,h[2]=0,h[3]=0,h}function je(o,h,y){const k=y??new i(4),C=o[0],r=o[1],d=o[2],s=o[3];return k[0]=h[0]*C+h[4]*r+h[8]*d+h[12]*s,k[1]=h[1]*C+h[5]*r+h[9]*d+h[13]*s,k[2]=h[2]*C+h[6]*r+h[10]*d+h[14]*s,k[3]=h[3]*C+h[7]*r+h[11]*d+h[15]*s,k}function $e(o,h,y){const k=y??new i(4);return Fe(o,k),xe(k,h,k)}function u(o,h,y){const k=y??new i(4);return ze(o)>h?$e(o,h,k):Pe(o,k)}function w(o,h,y){const k=y??new i(4);return re(o,h,.5,k)}return{create:e,fromValues:t,set:n,ceil:a,floor:p,round:x,clamp:S,add:O,addScaled:B,subtract:I,sub:V,equalsApproximately:z,equals:H,lerp:re,lerpV:he,max:ke,min:fe,mulScalar:xe,scale:le,divScalar:De,inverse:ve,invert:Te,dot:pe,length:ze,len:We,lengthSq:Ee,lenSq:Ze,distance:K,dist:ne,distanceSq:J,distSq:tt,normalize:Fe,negate:rt,copy:Pe,clone:nt,multiply:ae,mul:st,divide:qe,div:it,zero:Ve,transformMat4:je,setLength:$e,truncate:u,midpoint:w}}const As=new Map;function Ba(i){let e=As.get(i);return e||(e=Pa(i),As.set(i,e)),e}function jn(i,e,t,n,a,p){return{mat3:Ca(i),mat4:Ua(e),quat:Fa(t),vec2:oi(n),vec3:Un(a),vec4:Ba(p)}}const{mat3:Qe,mat4:no,quat:so,vec2:Xr,vec3:io,vec4:ao}=jn(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);jn(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);jn(Sa,Array,Array,Array,Array,Array);var ut,Gr,Pt,En,Mn,Sn,An,Zt,Ut,Yr,we,xr,et,nr,sr,Lt,_r,ot,Hr,mr,vr,Qr,jt,Yt,ci,ui,hi,$n;class Ia{constructor(e){P(this,Yt),P(this,ut),P(this,Gr,0),P(this,Pt,!1),P(this,En,Qe.create()),P(this,Mn,Qe.create()),P(this,Sn,Qe.create()),P(this,An,Qe.create()),P(this,Zt),P(this,Ut),P(this,Yr),P(this,we),P(this,xr),P(this,et),P(this,nr),P(this,sr),P(this,Lt),P(this,_r,new Float32Array([1,1])),P(this,ot,new Float32Array([0,0])),P(this,Hr,new Float32Array([0,0])),P(this,mr,new Float32Array([0,0])),P(this,vr,[void 0]),P(this,Qr),P(this,jt,ie({min:Xr.create(),max:Xr.create()})),F(this,Zt,e.label??"Shape"),F(this,ut,e.radius??0),F(this,we,e.renderer),F(this,Ut,e.segments);const{startAngle:t,endAngle:n,innerRadius:a}=e;W(this,Yt,ci).call(this,t,n,a),W(this,Yt,ui).call(this),W(this,Yt,hi).call(this),this.Scale=l(this,_r),this.Origin=l(this,ot),this.Rotation=l(this,Gr),this.Position=l(this,mr)}Update(){return l(this,we).SetVertexBuffers(l(this,sr)),l(this,we).SetIndexBuffer(l(this,nr)),l(this,we).SetBindGroups(l(this,vr)),W(this,Yt,$n).call(this)}Render(e=!0){l(this,we).SavePipelineState(),l(this,we).Render(l(this.Update(),Yr),e),l(this,we).RestorePipelineState()}AddBindGroups(e){l(this,vr).push(...Array.isArray(e)&&e||[e])}set Color(e){l(this,xr).set(Array.isArray(e)||ArrayBuffer.isView(e)?e:e.rgba),l(this,we).WriteBuffer(l(this,Lt),l(this,xr),l(this,Qr).color)}get Color(){return l(this,xr)}set Position(e){l(this,mr).set(e),Qe.translation(l(this,mr),l(this,An)),F(this,Pt,!0)}get Position(){return l(this,mr)}set Rotation(e){Qe.rotation(F(this,Gr,e),l(this,Sn)),F(this,Pt,!0)}get Rotation(){return l(this,Gr)}set Scale(e){l(this,_r).set(e),Qe.scaling(l(this,_r),l(this,Mn)),F(this,Pt,!0)}get Scale(){return l(this,_r)}set Origin(e){l(this,ot)[0]=e[0],l(this,ot)[1]=e[1],l(this,ot)[0]*=-l(this,ut),l(this,ot)[1]*=-l(this,ut),Qe.translation(l(this,ot),l(this,En)),l(this,ot)[0]=e[0]||0,l(this,ot)[1]=e[1]||0,F(this,Pt,!0)}get Origin(){return l(this,ot)}get Center(){return l(W(this,Yt,$n).call(this),Hr)}get Vertices(){return l(this,Yr)}get Transform(){return l(this,et)}get BoundingBox(){return l(this,jt)}Destroy(){l(this,vr).splice(0),F(this,nr,l(this,nr).destroy()),F(this,sr,l(this,sr).destroy()),F(this,Lt,l(this,Lt).destroy())}}ut=new WeakMap,Gr=new WeakMap,Pt=new WeakMap,En=new WeakMap,Mn=new WeakMap,Sn=new WeakMap,An=new WeakMap,Zt=new WeakMap,Ut=new WeakMap,Yr=new WeakMap,we=new WeakMap,xr=new WeakMap,et=new WeakMap,nr=new WeakMap,sr=new WeakMap,Lt=new WeakMap,_r=new WeakMap,ot=new WeakMap,Hr=new WeakMap,mr=new WeakMap,vr=new WeakMap,Qr=new WeakMap,jt=new WeakMap,Yt=new WeakSet,ci=function(i=0,e=vi.TAU,t=0){const n=e-i,a=new Float32Array((l(this,Ut)+1)*2*3);for(let p=0,x=0;x<=l(this,Ut);++x){const S=i+x*n/l(this,Ut),O=Math.cos(S),B=Math.sin(S);a[p++]=O*l(this,ut),a[p++]=B*l(this,ut),a[p++]=O*t,a[p++]=B*t}F(this,sr,l(this,we).CreateVertexBuffer(a,{label:`${l(this,Zt)} Vertex Buffer`})),l(this,we).WriteBuffer(l(this,sr),a)},ui=function(){const i=new Uint32Array(F(this,Yr,l(this,Ut)*6));for(let e=0,t=0;t<l(this,Ut);++t){const n=t*2;i[e++]=n+1,i[e++]=n+3,i[e++]=n+2,i[e++]=n+2,i[e++]=n+0,i[e++]=n+1}F(this,nr,l(this,we).CreateIndexBuffer(i,{label:`${l(this,Zt)} Index Buffer`})),l(this,we).WriteBuffer(l(this,nr),i)},hi=function(){const{buffer:i,shape:{color:e,matrix:t}}=l(this,we).CreateUniformBuffer("shape",{label:`${l(this,Zt)} Uniform Buffer`});F(this,Lt,i),F(this,et,t),F(this,xr,e),l(this,vr)[0]=l(this,we).CreateBindGroup(l(this,we).CreateBindGroupEntries([{buffer:l(this,we).ResolutionBuffer},{buffer:l(this,Lt)}]),0,`${l(this,Zt)} Bind Group`),F(this,Qr,ie({matrix:e.length*Float32Array.BYTES_PER_ELEMENT,color:0*Float32Array.BYTES_PER_ELEMENT}))},$n=function(){if(l(this,Pt)){Qe.multiply(l(this,An),l(this,Sn),l(this,et)),Qe.multiply(l(this,et),l(this,Mn),l(this,et)),Qe.multiply(l(this,et),l(this,En),l(this,et)),l(this,we).WriteBuffer(l(this,Lt),l(this,et),l(this,Qr).matrix);const i=l(this,Hr)[0]=l(this,et)[8],e=l(this,Hr)[1]=l(this,et)[9];l(this,jt).min[0]=i-l(this,ut),l(this,jt).min[1]=e-l(this,ut),l(this,jt).max[0]=i+l(this,ut),l(this,jt).max[1]=e+l(this,ut),F(this,Pt,!1)}return this};ie({TRIANGLE:3,SQUARE:4,PENTAGON:5,HEXAGON:6,HEPTAGON:7,OCTAGON:8,NONAGON:9,DECAGON:10,DODECAGON:12});var ir,br,Tr,Jt,Er,Nn,On,de,Zr,jr,Bt,Dt,ar,Tt,Jr,Lr,Ht,oe,ht,li,di,Ns,Os,Cn,Xn;const xn=class vn{constructor(e){P(this,ht),P(this,br),P(this,Tr),P(this,Jt),P(this,Er),P(this,Nn),P(this,On),P(this,de),P(this,Zr),P(this,jr),P(this,Bt),P(this,Dt),P(this,ar),P(this,Tt),P(this,Jr),P(this,Lr,Qe.create()),P(this,Ht,[void 0]),P(this,oe,ie({min:Xr.create(),max:Xr.create(),size:Xr.create()}));const{font:t,color:n,renderer:a,size:p=16,background:x,lineGap:S=0,hinting:O=!0,subpixel:B=!0,label:I="SDFText"}=e;F(this,br,t),F(vn,ir,I),F(this,Nn,O),F(this,On,B),F(this,de,a),this.Size=p??16,W(this,ht,li).call(this),this.Color=n??[0,0,0,1],F(this,Er,l(this,Jt)*S),this.Background=x??[1,1,1,1]}static async GetFragmentStateParams(e,t="",n,a,p){const x=e.CreateBlendComponent(n,a??"src1",p??"one-minus-src1");let S=Array.isArray(t)&&t.join(`

`)||t;const O=(await Or.Device).features.has("dual-source-blending");return S=`${$s}

${S}`,O&&(S=`${Ws}

${S}`),{target:e.CreateTargetState(void 0,O&&{color:x}||void 0),module:e.CreateShaderModule(S,`${l(vn,ir)} Shader Module`),entry:O&&"dsbTextFragment"||"textFragment",constants:{TRIPLET_FACTOR:.6},shader:S}}async SetFontTexture(e,t="r8unorm"){const n=new(await Or.Texture()),a=n.CopyImageToTexture(e,{create:{format:t},mipmaps:!1});l(this,Jr).set([a.width,a.height]),l(this,de).WriteBuffer(l(this,Bt),l(this,Jr)),l(this,Ht)[0]=l(this,de).CreateBindGroup(l(this,de).CreateBindGroupEntries([n.CreateSampler({filter:"linear"}),{buffer:l(this,Bt)},{buffer:l(this,Dt)},a.createView()]),0,`${l(vn,ir)} Bind Group`)}AddBindGroups(e){l(this,Ht).push(...Array.isArray(e)&&e||[e])}Write(e,t=[0,0]){!l(this,Ht)[0]&&te(Y.FONT_TEXTURE_NOT_FOUND,"`SDFText.Write` method. Call `SDFText.SetFontTexture` method before writing any string."),F(this,Tr,e),W(this,ht,di).call(this),t=t.map(n=>-n),W(this,ht,Xn).call(this,l(this,ar),t)}Render(e=!0){l(this,de).SavePipelineState(),l(this,de).SetBindGroups(l(this,Ht)),l(this,de).SetVertexBuffers(l(this,Tt)),l(this,de).Render(l(this,ar).length/5,e),l(this,de).RestorePipelineState()}Resize(){W(this,ht,Cn).call(this)}Destroy(){l(this,Ht).splice(0),F(this,Bt,l(this,Bt).destroy()),F(this,Dt,l(this,Dt).destroy()),F(this,Tt,l(this,Tt).destroy())}set Position([e,t]){l(this,oe).min[0]=e,l(this,oe).min[1]=t,l(this,oe).size[0]=l(this,oe).max[0]-e,l(this,oe).size[1]=l(this,oe).max[1]-t,l(this,oe).max[0]+=e,l(this,oe).max[1]+=t,W(this,ht,Cn).call(this)}set Background(e){l(this,Zr).set(e instanceof tn?e.rgba:e),l(this,de).WriteBuffer(l(this,Dt),l(this,Zr).buffer)}set Color(e){l(this,jr).set(e instanceof tn?e.rgba:e),l(this,de).WriteBuffer(l(this,Dt),l(this,jr).buffer)}set Size(e){const t=l(this,Er)/l(this,Jt);if(F(this,Jt,Math.round(l(this,de).DevicePixelRatio*e)),!l(this,Tt))return;F(this,Er,l(this,Jt)*t);const n=l(this,oe).min.map((a,p)=>a*(p*-1+.5));W(this,ht,Xn).call(this,l(this,ar),n)}get BoundingBox(){return l(this,oe)}};ir=new WeakMap,br=new WeakMap,Tr=new WeakMap,Jt=new WeakMap,Er=new WeakMap,Nn=new WeakMap,On=new WeakMap,de=new WeakMap,Zr=new WeakMap,jr=new WeakMap,Bt=new WeakMap,Dt=new WeakMap,ar=new WeakMap,Tt=new WeakMap,Jr=new WeakMap,Lr=new WeakMap,Ht=new WeakMap,oe=new WeakMap,ht=new WeakSet,li=function(){const{buffer:i,Text:{matrix:e,texureSize:t}}=l(this,de).CreateUniformBuffer("Text",{label:`${l(xn,ir)} Uniform Buffer`}),{buffer:n,Font:{color:a,back:p,subpx:x,hint:S}}=l(this,de).CreateUniformBuffer("Font",{label:`${l(xn,ir)} Font Uniform Buffer`});F(this,Bt,i),F(this,Lr,e),F(this,Jr,t),F(this,Dt,n),x[0]=+l(this,On),S[0]=+l(this,Nn),F(this,jr,a),F(this,Zr,p)},di=function(){var i;(i=l(this,Tt))==null||i.destroy(),F(this,ar,new Float32Array(l(this,Tr).length*6*5)),F(this,Tt,l(this,de).CreateVertexBuffer(l(this,ar)))},Ns=function(){const{cap_height:i,ascent:e,x_height:t,descent:n,line_gap:a}=l(this,br),p=l(this,Jt)/i;return{capScale:p,ascent:Math.round(e*p),lowScale:Math.round(t*p)/t,lineHeight:Math.round((e+n+a)*p+l(this,Er))}},Os=function([i,e],t,n,a=0){const{aspect:p,ix:x,descent:S,iy:O,row_height:B}=l(this,br),{flags:I,bearing_x:V,rect:z,advance_x:H}=n,{lowScale:re,capScale:he,ascent:ke}=t,fe=I&1?re:he,xe=p*fe,le=i+xe*(V+a-x),De=le+xe*(z[2]-z[0]),ve=e-ke-fe*(S+O),Te=ve+fe*B;i+=H*xe;const pe=fe*O*2;return{position:[i,e],vertices:[le,Te,z[0],z[1],pe,De,Te,z[2],z[1],pe,le,ve,z[0],z[3],pe,le,ve,z[0],z[3],pe,De,Te,z[2],z[1],pe,De,ve,z[2],z[3],pe]}},Cn=function(){const[i,e]=l(this,de).CanvasSize,t=Math.round(l(this,oe).size[0]*-.5),n=Math.round(l(this,oe).size[1]*.5),a=2/(Math.round(i*.5)*2),p=2/(Math.round(e*.5)*2);Qe.set(a,0,0,0,p,0,t*a,n*p,1,l(this,Lr)),l(this,de).WriteBuffer(l(this,Bt),l(this,Lr).buffer)},Xn=function(i,e){let t=0,n=" ",a=e,p=0,x=0;const S=W(this,ht,Ns).call(this),{lineHeight:O,capScale:B}=S,{space_advance:I,chars:V,kern:z}=l(this,br);for(;!(p===l(this,Tr).length||i.length<=x);){let H=l(this,Tr)[p++];if(H===`
`){t=Math.max(t,a[0]),a[1]-=O,a[0]=e[0],n=" ";continue}if(H===" "){a[0]+=I*B,n=" ";continue}let re=V[H];re||(re=V[H="?"]);const he=W(this,ht,Os).call(this,a,S,re,z[n+H]);for(let ke=0,fe=he.vertices.length;ke<fe;++ke)i[x++]=he.vertices[ke];a=he.position,n=H}l(this,oe).min[0]=e[0],l(this,oe).min[1]=e[1],l(this,oe).max[0]=t||a[0],l(this,oe).max[1]=a[1]+O,l(this,oe).size[0]=l(this,oe).max[0]-l(this,oe).min[0],l(this,oe).size[1]=l(this,oe).max[1]-l(this,oe).min[1],l(this,de).WriteBuffer(l(this,Tt),i),W(this,ht,Cn).call(this)},P(xn,ir,"SDFText");let Fn=xn;console.info("%cUWAL v0.0.10","background:#005a9c;padding:3px;color:#fff;");const Ga=""+new URL("../fonts/roboto-regular.json",import.meta.url).href,La=""+new URL("../fonts/roboto-regular.png",import.meta.url).href,qa=""+new URL("../fonts/roboto-bold.json",import.meta.url).href,Va=""+new URL("../fonts/roboto-bold.png",import.meta.url).href,za=`@group(1) @binding(0) var BackgroundSampler: sampler;
@group(1) @binding(1) var<uniform> TextureOffset: vec2f;
@group(1) @binding(2) var BackgroundTexture: texture_2d<f32>;

@fragment fn fragment(input: TextVertexOutput) -> @location(0) vec4f
{
    let backgroundOffset = TextureOffset * vec2f(-1, 1);
    var backgroundUV = input.screenUV * 0.5 + 0.5;

    backgroundUV *= 1 - backgroundOffset * 2;
    backgroundUV += backgroundOffset;
    backgroundUV.y = 1 - backgroundUV.y;

    let coverage = GetSubpixelCoverage(input.inverseTexureSize, input.distanceDelta, input.fontUV);
    let background = textureSample(BackgroundTexture, BackgroundSampler, backgroundUV).rgb;

    return vec4f(mix(background, Font.color.rgb, coverage), Font.color.a);
}
`,Wa=`const TAU = radians(180) * 2;
const FRAMEBUFFER = false;

struct VertexOutput
{
    @location(0) backCoord: vec2f,
    @location(1) textCoord: vec2f,
    @builtin(position) position: vec4f
};

@group(0) @binding(0) var Sampler: sampler;
@group(0) @binding(1) var Text: texture_2d<f32>;
@group(0) @binding(2) var Waves: texture_2d<f32>;
@group(0) @binding(3) var Background: texture_2d<f32>;
@group(0) @binding(4) var<uniform> BackgroundOffset: vec2f;

@vertex fn vertex(@builtin(vertex_index) index: u32) -> VertexOutput
{
    let position = GetQuadCoord(index);
    let coord = (position + 1) * 0.5;
    var output: VertexOutput;

    output.position = vec4f(position, 0, 1);
    output.textCoord = vec2f(coord.x, 1 - coord.y);
    output.backCoord = output.textCoord + BackgroundOffset * sign(position);

    return output;
}

fn distort(uv: vec2f, distortion: f32) -> vec2f
{
    let theta = distortion * TAU;
    let direction = vec2f(sin(theta), cos(theta));
    return uv + distortion * direction * 0.1 /* strength */;
}

@fragment fn fragment(
    @location(0) backCoord: vec2f,
    @location(1) textCoord: vec2f
) -> @location(0) vec4f
{
    let wave = textureSample(Waves, Sampler, textCoord).x;
    if (FRAMEBUFFER == true) { return vec4f(vec3f(wave), 1); }

    let backDistortion = distort(backCoord, wave);
    let textDistortion = distort(textCoord, wave);

    let backColor = textureSample(Background, Sampler, backDistortion);
    let textColor = textureSample(Text, Sampler, textDistortion);

    return mix(backColor, textColor, textColor.a);
}
`,$a=`struct VertexOutput
{
    @location(0) uv: vec2f,
    @location(1) alpha: f32,
    @builtin(position) position: vec4f
};

@group(1) @binding(0) var Sampler: sampler;
@group(1) @binding(1) var Texture: texture_2d<f32>;

fn RotateOutputUV(uv: vec2f, angle: f32) -> vec2f
{
    let c = cos(angle);
    let s = sin(angle);

    let x = uv.x - 0.5;
    let y = uv.y - 0.5;

    return vec2f(
        c * x + s * y + 0.5,
        c * y - s * x + 0.5
    );
}

@vertex fn vertex(
    @location(0) position: vec2f,
    @location(1) offset: vec2f,
    @location(2) angle: f32,
    @location(3) scale: f32,
    @location(4) alpha: f32
) -> VertexOutput
{
    var output: VertexOutput;
    let aspect = resolution / resolution.x;
    let clipSpace = GetVertexClipSpace(position).xy;
    output.position = vec4f(clipSpace + offset, 0, 1);

    output.uv  = (clipSpace + 1) / 2;
    output.uv += clipSpace / scale;
    output.uv *= aspect;
    output.uv += vec2f((1 - aspect) / 2);
    output.uv  = RotateOutputUV(output.uv, angle);

    output.alpha = alpha;
    return output;
}

@fragment fn fragment(input: VertexOutput) -> @location(0) vec4f
{
    let color = textureSample(Texture, Sampler, input.uv);
    return vec4f(color.rgb, color.a * input.alpha);
}
`,Xa=""+new URL("../ripple.png",import.meta.url).href,Ya=""+new URL("../ocean.jpg",import.meta.url).href,Yn=new Array(2),Rr=128,Ft=document.getElementById("scene");let $,nn,sn,or,Kt,Mr,Kr,fi,pi,Cs;await Or.SetRequiredFeatures(["bgra8unorm-storage"]);try{$=new(await Or.RenderPipeline(Ft))}catch(i){alert(i),Ft.style.width=Ft.width=innerWidth,Ft.style.height=Ft.height=innerHeight,Ft.style.background="center / cover no-repeat url('./preview.jpg')"}let Rs=performance.now(),_i=!1,Hn=!1,Ur=0;const Us=Array.from({length:Rr}).map(()=>({angle:0,scale:0,alpha:0})),Ds=async i=>(await fetch(i)).json();function Rn(i,e=[0,0]){const[t,n]=$.CanvasSize,a=i.width/i.height;if($.AspectRatio<a){const p=n*a;e[0]=(p-t)/2/p*-1}else{const p=t/a;e[1]=(p-n)/2/p}return e}const Ha=()=>Math.random()*Math.PI*2,mn=i=>new Promise(e=>{const t=new Image;t.src=i,t.onload=()=>e(t)});async function Qa(i){const e=gt.CopyImageToTexture(await gt.CreateBitmapImage(i,{colorSpaceConversion:"none"}),{mipmaps:!1,create:!0});Kr=new Ia({renderer:$,segments:4,radius:256}),Kr.Position=[Ft.width/2,Ft.height/2],Kr.AddBindGroups($.CreateBindGroup($.CreateBindGroupEntries([gt.CreateSampler({filter:"linear"}),e.createView()]),1))}function Za(){const i=performance.now(),e=(i-Rs)/1e3,t=e*5,n=e*2;if(Hn){Ur=(Ur+1)%Rr;const p=Us[Ur],x=Ha(),S=Ur*Ps;St.set([p.angle=x],S+2),St.set([p.scale=.1],S+3),St.set([p.alpha=.192],S+4)}for(let p=0;p<Rr;p++){const x=Us[p],S=p*Ps,O=x.scale*n;x.alpha=Math.max(x.alpha*.96,.002),x.angle+=x.alpha*t+n,x.scale=Math.min(x.scale+O,1),Ur===p&&St.set(Yn,S),St.set([x.angle],S+2),St.set([x.scale],S+3),St.set([x.alpha],S+4)}$.WriteBuffer(Qn,St);const a=Kr.Update().Vertices;return $.AddVertexBuffers(Qn),Rs=i,a}function ja(i){Hn=!0,clearTimeout(Cs);const[e,t]=$.BaseCanvasSize;Yn[0]=i.clientX/e*2-1,Yn[1]=i.clientY/t*-2+1,Cs=setTimeout(()=>Hn=!1,16.667)}const Fs=$.CreateShaderModule([Xs.ShapeVertex,$a]),Ja=$.CreateBlendComponent(void 0,"src-alpha","one"),Ka=$.CreateVertexBufferLayout("position"),eo=$.CreateTargetState(void 0,{color:Ja}),{buffer:Qn,layout:to}=$.CreateVertexBuffer(["offset","angle","scale","alpha"],Rr,"instance"),ro=$.CreatePipeline({fragment:$.CreateFragmentState(Fs,void 0,eo),vertex:$.CreateVertexState(Fs,void 0,[Ka,to])}),mi=Qn.size/Float32Array.BYTES_PER_ELEMENT,St=new Float32Array(mi),Ps=mi/Rr,Nr={buffer:null,offset:null},en={buffer:null,offset:null},gt=new(await Or.Texture($));Promise.all([Ds(qa),mn(Ya),mn(Xa),Ds(Ga),mn(Va),mn(La)]).then(async([i,e,t,n,a,p])=>{await Qa(t);const{module:x,target:S}=await Fn.GetFragmentStateParams($,za),O=$.CreateVertexBufferLayout(["position","texture","size"],void 0,"textVertex");fi=$.CreatePipeline({vertex:$.CreateVertexState(x,"textVertex",O),fragment:$.CreateFragmentState(x,void 0,S)});const B=new tn(255,255,255,229),I=new tn(0,90,156,204);Mr=new Fn({color:B,renderer:$,font:n,size:24}),Kt=new Fn({renderer:$,color:I,font:i,size:144}),await Kt.SetFontTexture(a),await Mr.SetFontTexture(p),Kt.Write("UWAL"),Mr.Write("Unopinionated WebGPU Abstraction Library"),sn=gt.CreateStorageTexture({usage:GPUTextureUsage.RENDER_ATTACHMENT}),nn=gt.CreateStorageTexture({usage:GPUTextureUsage.RENDER_ATTACHMENT}),or=gt.CopyImageToTexture(e,{mipmaps:!1,create:!0});const{buffer:V,TextureOffset:z}=$.CreateUniformBuffer("TextureOffset");z.set(Rn(or)),$.WriteBuffer(V,z),en.buffer=V,en.offset=z,Kt.AddBindGroups($.CreateBindGroup($.CreateBindGroupEntries([gt.CreateSampler(),{buffer:V},or.createView()]),1)),pi=$.CreatePipeline($.CreateShaderModule([Xs.Quad,Wa]));const{buffer:H,BackgroundOffset:re}=$.CreateUniformBuffer("BackgroundOffset");re.set(Rn(or)),$.WriteBuffer(H,re),Nr.buffer=H,Nr.offset=re,addEventListener("mousemove",ja,!1);const he=$.DevicePixelRatio;Mr.Position=[0,100*he],Kt.Position=[0,-100*he],requestAnimationFrame(gi),_i=!0});function gi(){$.SetPipeline(ro),$.TextureView=sn.createView(),$.Render([Za(),Rr],!1),$.DestroyCurrentPass(),$.ResetPipelineState(),$.SetPipeline(fi),$.TextureView=nn.createView(),Kt.Render(!1),Mr.Render(!1),$.DestroyCurrentPass(),$.SetPipeline(pi),$.SetBindGroups($.CreateBindGroup($.CreateBindGroupEntries([gt.CreateSampler(),nn.createView(),sn.createView(),or.createView(),{buffer:Nr.buffer}]))),requestAnimationFrame(gi),$.TextureView=void 0,$.Render(6)}function yi(){$.SetCanvasSize(innerWidth,innerHeight),_i&&(Kt.Resize(),Mr.Resize(),nn.destroy(),sn.destroy(),Kr.Position=[innerWidth/2,innerHeight/2],en.offset.set(Rn(or)),$.WriteBuffer(en.buffer,en.offset),Nr.offset.set(Rn(or)),$.WriteBuffer(Nr.buffer,Nr.offset),nn=gt.CreateStorageTexture({usage:GPUTextureUsage.RENDER_ATTACHMENT}),sn=gt.CreateStorageTexture({usage:GPUTextureUsage.RENDER_ATTACHMENT}))}addEventListener("resize",yi,!1);yi();
